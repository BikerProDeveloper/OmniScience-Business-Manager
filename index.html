<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omni Studio â€” Complete Business Management Platform</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              ink: "#0b1220",
              ink2: "#131c2e",
              skyink: "#0f172a",
              brand: { DEFAULT: "#6d5efc", 50:"#f3f2ff",100:"#e7e6ff",200:"#cbc6ff",300:"#afa6ff",400:"#988eff",500:"#6d5efc",600:"#5c4fe0",700:"#4a3eb8",800:"#3a3090",900:"#2e2870" }
            },
            boxShadow: {
              glass: "0 10px 30px rgba(0,0,0,.2)"
            },
            animation: {
              'kenburns-slow': 'kenburns 30s ease-in-out infinite alternate',
              'float': 'float 6s ease-in-out infinite',
              'success-pulse': 'successPulse 2s ease-in-out',
              'bounce-in': 'bounceIn 0.6s ease-out'
            },
            keyframes: {
              kenburns: {
                '0%':   { transform: 'scale(1) translate(0,0)' },
                '100%': { transform: 'scale(1.2) translate(20px, 20px)' }
              },
              float: {
                '0%, 100%': { transform: 'translateY(-2px)' },
                '50%': { transform: 'translateY(2px)' }
              },
              successPulse: {
                '0%': { transform: 'scale(1)', opacity: '1' },
                '50%': { transform: 'scale(1.05)', opacity: '0.8' },
                '100%': { transform: 'scale(1)', opacity: '1' }
              },
              bounceIn: {
                '0%': { transform: 'scale(0.3)', opacity: '0' },
                '50%': { transform: 'scale(1.05)', opacity: '1' },
                '70%': { transform: 'scale(0.9)' },
                '100%': { transform: 'scale(1)', opacity: '1' }
              }
            },
            backdropBlur: {
              xs: '2px'
            }
          }
        }
      }
    </script>

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- HTML2Canvas for screenshots -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
      /* Glass + backdrop tuning */
      .glass {
        background: rgba(15, 23, 42, 0.55);
        backdrop-filter: blur(10px) saturate(120%);
        -webkit-backdrop-filter: blur(10px) saturate(120%);
        border: 1px solid rgba(255, 255, 255, .08);
      }
      .glass-light {
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(10px) saturate(120%);
        -webkit-backdrop-filter: blur(10px) saturate(120%);
        border: 1px solid rgba(0, 0, 0, .06);
      }
      /* Background layer */
      #bg-layer {
        position: fixed;
        inset: 0;
        z-index: -1;
        overflow: hidden;
        background: radial-gradient(1200px 800px at 10% 10%, rgba(109,94,252,.25), transparent 60%),
                    radial-gradient(1200px 800px at 90% 90%, rgba(16,185,129,.25), transparent 60%),
                    linear-gradient(120deg, #0b1220, #0f172a 60%, #111827);
      }
      #bg-img {
        position: absolute;
        inset: -5%;
        width: 110%;
        height: 110%;
        object-fit: cover;
        opacity: .5;
        transform-origin: center;
      }
      /* Scrollbar */
      ::-webkit-scrollbar { width: 10px; height: 10px; }
      ::-webkit-scrollbar-thumb { background: rgba(255,255,255,.18); border-radius: 99px; }
      ::-webkit-scrollbar-track { background: transparent; }
      /* Table compact cells */
      .table-compact th, .table-compact td { padding: .45rem .5rem; }
      /* Card hover */
      .card { transition: transform .2s ease, box-shadow .2s ease; }
      .card:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(0,0,0,.25); }
      /* Hidden by default for views */
      .view { display: none; }
      .view.active { display: block; }
      /* Small helper */
      pre.inline { display:inline-block; padding:.25rem .5rem; border-radius:.375rem; background:rgba(255,255,255,.06); }
      /* Omni PLUS panel */
      .mq-panel { background: rgba(15, 23, 42, 0.9); border-radius: 1rem; border: 1px solid rgba(239, 68, 68, 0.3); }
      /* API Status Indicators */
      .status-active { background: rgba(34, 197, 94, 0.2); color: rgb(74, 222, 128); border: 1px solid rgba(74, 222, 128, 0.3); }
      .status-warning { background: rgba(245, 158, 11, 0.2); color: rgb(251, 191, 36); border: 1px solid rgba(251, 191, 36, 0.3); }
      .status-inactive { background: rgba(239, 68, 68, 0.2); color: rgb(248, 113, 113); border: 1px solid rgba(248, 113, 113, 0.3); }
      /* Progress bars */
      .progress-bar { height: 8px; background: rgba(255,255,255,.1); border-radius: 4px; overflow: hidden; }
      .progress-fill { height: 100%; background: #6d5efc; border-radius: 4px; transition: width 0.3s; }
      /* Loading spinner */
      .loader { border: 2px solid #f3f4f6; border-top: 2px solid #6d5efc; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      /* Success animations */
      .success-animation { animation: successPulse 2s ease-in-out; }
      .bounce-in { animation: bounceIn 0.6s ease-out; }
      /* Quality score indicators */
      .quality-low { background: rgba(239, 68, 68, 0.2); color: rgb(248, 113, 113); }
      .quality-medium { background: rgba(245, 158, 11, 0.2); color: rgb(251, 191, 36); }
      .quality-high { background: rgba(34, 197, 94, 0.2); color: rgb(74, 222, 128); }
      .quality-excellent { background: rgba(34, 197, 94, 0.4); color: rgb(74, 222, 128); }
      /* Business Academy Styles */
      .phase-complete { background: rgba(34, 197, 94, 0.2); border-left: 4px solid rgb(34, 197, 94); }
      .phase-current { background: rgba(96, 165, 250, 0.2); border-left: 4px solid rgb(96, 165, 250); }
      .phase-upcoming { background: rgba(100, 116, 139, 0.2); border-left: 4px solid rgb(100, 116, 139); }
      .checklist-item.completed { text-decoration: line-through; opacity: 0.7; }
      .daily-task { transition: all 0.3s ease; }
      .daily-task:hover { transform: translateX(5px); }
      .mentor-note { background: rgba(245, 158, 11, 0.1); border-left: 4px solid rgb(245, 158, 11); }
    </style>
</head>
<body class="text-slate-100 bg-skyink min-h-screen">

  <!-- BACKGROUND -->
  <div id="bg-layer">
    <img id="bg-img" alt="background" class="hidden">
  </div>

  <!-- APP SHELL -->
  <div class="min-h-screen flex">
    <!-- SIDEBAR -->
    <aside class="w-72 hidden lg:flex lg:flex-col gap-3 p-4 glass">
      <div class="flex items-center gap-3 mb-1">
        <div class="h-10 w-10 rounded-2xl bg-brand-500 flex items-center justify-center shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="rocket" class="lucide lucide-rocket w-6 h-6"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"></path><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"></path><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"></path><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"></path></svg>
        </div>
        <div>
          <div class="text-lg font-semibold">Omni Studio</div>
          <div class="text-xs text-slate-300">Complete Business Platform</div>
        </div>
      </div>

      <nav id="nav" class="flex-1 overflow-auto pt-2">
        <ul class="space-y-1 text-sm">
          <li><button data-view="dashboard" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="layout-grid" class="lucide lucide-layout-grid"><rect width="7" height="7" x="3" y="3" rx="1"></rect><rect width="7" height="7" x="14" y="3" rx="1"></rect><rect width="7" height="7" x="14" y="14" rx="1"></rect><rect width="7" height="7" x="3" y="14" rx="1"></rect></svg> Dashboard</button></li>
          <li><button data-view="projects" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="briefcase" class="lucide lucide-briefcase"><path d="M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path><rect width="20" height="14" x="2" y="6" rx="2"></rect></svg> Projects</button></li>
<li>
  <button data-view="portfolio" class="nav-pill">
    <span class="icon">ðŸ“Š</span>
    <span>Portfolio</span>
  </button>
</li>
          <li><button data-view="clients" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="users" class="lucide lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><path d="M16 3.128a4 4 0 0 1 0 7.744"></path><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><circle cx="9" cy="7" r="4"></circle></svg> Clients</button></li>
          
          <!-- BUSINESS ACADEMY -->
          <li class="pt-4 text-xs text-slate-400 uppercase tracking-wider">Business Academy</li>
          <li><button data-view="academy-dashboard" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="graduation-cap" class="lucide lucide-graduation-cap"><path d="M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z"></path><path d="M22 10v6"></path><path d="M6 12.5V16a6 3 0 0 0 12 0v-3.5"></path></svg> Academy Dashboard</button></li>
          <li><button data-view="academy-lessons" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="book-open" class="lucide lucide-book-open"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg> Daily Lessons</button></li>
          <li><button data-view="client-acquisition" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="target" class="lucide lucide-target"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg> Client Acquisition</button></li>
          <li><button data-view="sales-system" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="trending-up" class="lucide lucide-trending-up"><path d="m22 7-8.5 8.5-5-5L2 17"></path><path d="M16 7h6v6"></path></svg> Sales System</button></li>
          
          <!-- BUSINESS TOOLS -->
          <li class="pt-4 text-xs text-slate-400 uppercase tracking-wider">Business Tools</li>
          <li><button data-view="orders" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="package" class="lucide lucide-package"><path d="M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z"></path><path d="M12 22V12"></path><polyline points="3.29 7 12 12 20.71 7"></path><path d="m7.5 4.27 9 5.15"></path></svg> Orders & Delivery</button></li>
          <li><button data-view="deployments" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="cloud" class="lucide lucide-cloud"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"></path></svg> Deployments</button></li>
          <li><button data-view="payments" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="credit-card" class="lucide lucide-credit-card"><rect width="20" height="14" x="2" y="5" rx="2"></rect><line x1="2" x2="22" y1="10" y2="10"></line></svg> Payments</button></li>
          <li><button data-view="domains" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="globe" class="lucide lucide-globe"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path d="M2 12h20"></path></svg> Domains</button></li>
          
          <!-- API & BUSINESS TOOLS -->
          <li class="pt-4 text-xs text-slate-400 uppercase tracking-wider">API & Business</li>
          <li><button data-view="api-inventory" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="key" class="lucide lucide-key"><path d="m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4"></path><path d="m21 2-9.6 9.6"></path><circle cx="7.5" cy="15.5" r="5.5"></circle></svg> API Inventory</button></li>
          <li><button data-view="content-studio" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="pen-square" class="lucide lucide-pen-square"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z"></path></svg> Content Studio</button></li>
          <li><button data-view="revenue" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="trending-up" class="lucide lucide-trending-up"><path d="m22 7-8.5 8.5-5-5L2 17"></path><path d="M16 7h6v6"></path></svg> Revenue & Goals</button></li>
          <li><button data-view="ads" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="megaphone" class="lucide lucide-megaphone"><path d="m3 11 18-5v12L3 14v-3z"></path><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"></path></svg> Ads & Affiliates</button></li>
          <li><button data-view="ai-apis" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="brain" class="lucide lucide-brain"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"></path><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"></path><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"></path><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"></path><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"></path><path d="M3.477 10.896a4 4 0 0 1 .585-.396"></path><path d="M19.938 10.5a4 4 0 0 1 .585.396"></path><path d="M6 18a4 4 0 0 1-1.967-.516"></path><path d="M19.967 17.484A4 4 0 0 1 18 18"></path></svg> AI & APIs</button></li>
          
          <!-- SYSTEM -->
          <li class="pt-4 text-xs text-slate-400 uppercase tracking-wider">System</li>
          <li><button data-view="file-manager" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="folder" class="lucide lucide-folder"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"></path></svg> File Manager</button></li>
          <li><button data-view="reminders" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="alarm-clock" class="lucide lucide-alarm-clock"><circle cx="12" cy="13" r="8"></circle><path d="M12 9v4l2 2"></path><path d="M5 3 2 6"></path><path d="m22 6-3-3"></path><path d="M6.38 18.7 4 21"></path><path d="M17.64 18.67 20 21"></path></svg> Reminders</button></li>
          <li><button data-view="integrations" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="puzzle" class="lucide lucide-puzzle"><path d="M15.39 4.39a1 1 0 0 0 1.68-.474 2.5 2.5 0 1 1 3.014 3.015 1 1 0 0 0-.474 1.68l1.683 1.682a2.414 2.414 0 0 1 0 3.414L19.61 15.39a1 1 0 0 1-1.68-.474 2.5 2.5 0 1 0-3.014 3.015 1 1 0 0 1 .474 1.68l-1.683 1.682a2.414 2.414 0 0 1-3.414 0L8.61 19.61a1 1 0 0 0-1.68.474 2.5 2.5 0 1 1-3.014-3.015 1 1 0 0 0 .474-1.68l-1.683-1.682a2.414 2.414 0 0 1 0-3.414L4.39 8.61a1 1 0 0 1 1.68.474 2.5 2.5 0 1 0 3.014-3.015 1 1 0 0 1-.474-1.68l1.683-1.682a2.414 2.414 0 0 1 3.414 0z"></path></svg> Integrations</button></li>
          <li><button data-view="docs" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="file-text" class="lucide lucide-file-text"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="M10 9H8"></path><path d="M16 13H8"></path><path d="M16 17H8"></path></svg> Docs & Templates</button></li>
          <li><button data-view="settings" class="nav-btn w-full text-left px-3 py-2 rounded-md hover:bg-white/10 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="settings" class="lucide lucide-settings"><path d="M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"></path><circle cx="12" cy="12" r="3"></circle></svg> Settings</button></li>
        </ul>
      </nav>

      <div class="mt-auto text-xs text-slate-300">
        <div class="flex items-center justify-between">
          <span>Theme</span>
          <label class="inline-flex items-center cursor-pointer">
            <input id="themeToggle" type="checkbox" class="sr-only">
            <span class="w-10 h-5 bg-white/20 rounded-full relative">
              <span class="dot absolute left-1 top-1 w-3 h-3 bg-white rounded-full transition"></span>
            </span>
          </label>
        </div>
        <div class="mt-2">Backup: <button id="btnExport" class="underline">Export</button> Â· <label for="importFile" class="underline cursor-pointer">Import</label><input id="importFile" type="file" accept="application/json" class="hidden"></div>
        <div class="mt-2">Â© <span id="year">2025</span> Omni Studio</div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="flex-1 p-4 lg:p-6 space-y-4">

      <!-- TOP BAR -->
      <div class="glass rounded-2xl p-3 lg:p-4 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <button id="openNav" class="lg:hidden inline-flex items-center justify-center h-10 w-10 rounded-xl hover:bg-white/10">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="panel-left" class="lucide lucide-panel-left"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M9 3v18"></path></svg>
          </button>
          <div class="text-lg font-semibold">Complete Business Management Platform</div>
          <span class="text-xs px-2 py-1 ml-2 rounded-full bg-brand-500/20 text-brand-200 border border-brand-500/30">Live System</span>
        </div>
        <div class="flex items-center gap-2">
          <input id="search" placeholder="Search projects, clients, APIsâ€¦" class="w-52 lg:w-80 bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-brand-500/50">
          <button id="quickAdd" class="hidden sm:inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600 text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus" class="lucide lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>Quick Add</button>
        </div>
      </div>

      <!-- DASHBOARD VIEW -->
      <section id="view-dashboard" class="view active">
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
          <div class="card glass rounded-2xl p-4">
            <div class="text-slate-300 text-sm">Active Projects</div>
            <div class="text-3xl font-semibold mt-1" id="kpi-projects">-</div>
            <div class="mt-3 h-2 bg-white/10 rounded-full overflow-hidden"><div id="bar-projects" class="h-full bg-brand-500" style="width: 0%;"></div></div>
          </div>
          <div class="card glass rounded-2xl p-4">
            <div class="text-slate-300 text-sm">API Revenue</div>
            <div class="text-3xl font-semibold mt-1" id="kpi-revenue">-</div>
            <div class="mt-3 h-2 bg-white/10 rounded-full overflow-hidden"><div id="bar-revenue" class="h-full bg-emerald-500" style="width:0%"></div></div>
          </div>
          <div class="card glass rounded-2xl p-4">
            <div class="text-slate-300 text-sm">API Keys</div>
            <div class="text-3xl font-semibold mt-1" id="kpi-keys">-</div>
            <div class="mt-3 text-xs text-slate-300">Active API integrations</div>
          </div>
          <div class="card glass rounded-2xl p-4">
            <div class="text-slate-300 text-sm">Client Usage</div>
            <div class="text-3xl font-semibold mt-1" id="kpi-usage">-</div>
            <div class="mt-3 text-xs text-slate-300">API call utilization</div>
          </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-3 gap-4 mt-4">
          <div class="xl:col-span-2 glass rounded-2xl p-4">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-semibold">Business Pipeline</h3>
              <button class="text-sm underline" onclick="openView('projects')">Manage Projects</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mt-2">
              <div class="rounded-xl p-3 bg-white/5">
                <div class="text-sm text-slate-300">Leads</div>
                <ul id="pipe-leads" class="mt-2 space-y-1 text-sm"><li class="text-slate-400 text-center">No items</li></ul>
              </div>
              <div class="rounded-xl p-3 bg-white/5">
                <div class="text-sm text-slate-300">Development</div>
                <ul id="pipe-dev" class="mt-2 space-y-1 text-sm"><li class="text-slate-400 text-center">No items</li></ul>
              </div>
              <div class="rounded-xl p-3 bg-white/5">
                <div class="text-sm text-slate-300">Testing</div>
                <ul id="pipe-testing" class="mt-2 space-y-1 text-sm"><li class="text-slate-400 text-center">No items</li></ul>
              </div>
              <div class="rounded-xl p-3 bg-white/5">
                <div class="text-sm text-slate-300">Delivered</div>
                <ul id="pipe-delivered" class="mt-2 space-y-1 text-sm"><li class="text-slate-400 text-center">No items</li></ul>
              </div>
            </div>
          </div>
          <div class="glass rounded-2xl p-4">
            <h3 class="text-lg font-semibold">Quick Actions</h3>
            <div class="space-y-2 mt-3">
              <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 flex items-center gap-2" onclick="openView('projects')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="briefcase" class="lucide lucide-briefcase"><path d="M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path><rect width="20" height="14" x="2" y="6" rx="2"></rect></svg>
                New Project
              </button>
              <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 flex items-center gap-2" onclick="openView('content-studio')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="pen-square" class="lucide lucide-pen-square"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z"></path></svg>
                Create Content
              </button>
              <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 flex items-center gap-2" onclick="openView('api-inventory')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="key" class="lucide lucide-key"><path d="m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4"></path><path d="m21 2-9.6 9.6"></path><circle cx="7.5" cy="15.5" r="5.5"></circle></svg>
                Add API Key
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- BUSINESS ACADEMY DASHBOARD -->
      <section id="view-academy-dashboard" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-2xl font-bold">Business Academy</h3>
              <p class="text-slate-300 mt-1">Your 90-Day Path to Business Mastery</p>
            </div>
            <div class="text-right">
              <div class="text-sm text-slate-300">Current Phase</div>
              <div class="text-xl font-semibold" id="current-phase">Foundation (Days 1-30)</div>
            </div>
          </div>

          <!-- Progress Overview -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="card glass rounded-2xl p-4 text-center">
              <div class="text-3xl font-semibold" id="academy-days">1</div>
              <div class="text-sm text-slate-300">Days Completed</div>
            </div>
            <div class="card glass rounded-2xl p-4 text-center">
              <div class="text-3xl font-semibold" id="academy-lessons">0</div>
              <div class="text-sm text-slate-300">Lessons Completed</div>
            </div>
            <div class="card glass rounded-2xl p-4 text-center">
              <div class="text-3xl font-semibold" id="academy-clients">0</div>
              <div class="text-sm text-slate-300">Clients Acquired</div>
            </div>
            <div class="card glass rounded-2xl p-4 text-center">
              <div class="text-3xl font-semibold" id="academy-revenue">$0</div>
              <div class="text-sm text-slate-300">Revenue Generated</div>
            </div>
          </div>

          <!-- 90-Day Journey -->
          <div class="mb-6">
            <h4 class="text-lg font-semibold mb-4">Your 90-Day Transformation Journey</h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="phase-complete rounded-2xl p-4">
                <div class="font-semibold mb-2">Phase 1: Foundation</div>
                <div class="text-sm text-slate-300 mb-3">Days 1-30: First $1,000</div>
                <ul class="text-sm space-y-1">
                  <li class="checklist-item completed">âœ“ Platform Setup</li>
                  <li class="checklist-item completed">âœ“ Portfolio Creation</li>
                  <li class="checklist-item">Pricing Strategy</li>
                  <li class="checklist-item">First Clients</li>
                </ul>
              </div>
              <div class="phase-current rounded-2xl p-4">
                <div class="font-semibold mb-2">Phase 2: Systemize</div>
                <div class="text-sm text-slate-300 mb-3">Days 31-60: Consistent $3,000/Month</div>
                <ul class="text-sm space-y-1">
                  <li class="checklist-item">Business Processes</li>
                  <li class="checklist-item">Client Waitlist</li>
                  <li class="checklist-item">Price Increase</li>
                  <li class="checklist-item">Team Building</li>
                </ul>
              </div>
              <div class="phase-upcoming rounded-2xl p-4">
                <div class="font-semibold mb-2">Phase 3: Scale</div>
                <div class="text-sm text-slate-300 mb-3">Days 61-90: Passive Income Foundation</div>
                <ul class="text-sm space-y-1">
                  <li class="checklist-item">Premium Offers</li>
                  <li class="checklist-item">Digital Products</li>
                  <li class="checklist-item">Agency Model</li>
                  <li class="checklist-item">Exit Strategy</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Today's Focus -->
          <div class="glass rounded-2xl p-4 mb-6">
            <h4 class="text-lg font-semibold mb-3">Today's Focus</h4>
            <div class="mentor-note p-3 rounded-lg mb-3">
              <div class="font-semibold">ðŸŽ¯ Strategic Guidance:</div>
              <div class="text-sm mt-1">
                Use the 90â€‘Day Academy on the left and the Content Studio on the right together:
                complete today's checklist for your current phase, then generate at least one real post and publish it.
              </div>
            </div>
            <div class="space-y-2 text-sm">
              <div class="daily-task flex items-center gap-3 p-2 hover:bg-white/5 rounded">
                <span class="inline-flex h-6 w-6 items-center justify-center rounded-full bg-brand-500/20 text-xs">1</span>
                <div>
                  <div class="font-semibold">Phase 1 (Days 1â€“30): Foundation</div>
                  <div class="text-xs text-slate-300">Finish your offer, polish your profiles, and create at least one real portfolio asset.</div>
                </div>
              </div>
              <div class="daily-task flex items-center gap-3 p-2 hover:bg-white/5 rounded">
                <span class="inline-flex h-6 w-6 items-center justify-center rounded-full bg-brand-500/20 text-xs">2</span>
                <div>
                  <div class="font-semibold">Phase 2 (Days 31â€“60): Systemize</div>
                  <div class="text-xs text-slate-300">Document how you get clients and deliver work so you can repeat it every week.</div>
                </div>
              </div>
              <div class="daily-task flex items-center gap-3 p-2 hover:bg-white/5 rounded">
                <span class="inline-flex h-6 w-6 items-center justify-center rounded-full bg-brand-500/20 text-xs">3</span>
                <div>
                  <div class="font-semibold">Phase 3 (Days 61â€“90): Scale</div>
                  <div class="text-xs text-slate-300">Turn your knowâ€‘how into products and premium offers that can sell without you.</div>
                </div>
              </div>
            </div>
          </div>
<!-- Quick Access -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <button onclick="openView('academy-lessons')" class="card glass rounded-2xl p-4 text-center hover:bg-white/5">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="book-open" class="lucide lucide-book-open mx-auto mb-2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
              <div class="font-semibold">Daily Lessons</div>
            </button>
            <button onclick="openView('client-acquisition')" class="card glass rounded-2xl p-4 text-center hover:bg-white/5">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="target" class="lucide lucide-target mx-auto mb-2"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
              <div class="font-semibold">Client Acquisition</div>
            </button>
            <button onclick="openView('sales-system')" class="card glass rounded-2xl p-4 text-center hover:bg-white/5">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="trending-up" class="lucide lucide-trending-up mx-auto mb-2"><path d="m22 7-8.5 8.5-5-5L2 17"></path><path d="M16 7h6v6"></path></svg>
              <div class="font-semibold">Sales System</div>
            </button>
            <button onclick="openView('revenue')" class="card glass rounded-2xl p-4 text-center hover:bg-white/5">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="dollar-sign" class="lucide lucide-dollar-sign mx-auto mb-2"><line x1="12" x2="12" y1="2" y2="22"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
              <div class="font-semibold">Revenue Tracking</div>
            </button>
          </div>
        </div>
      </section>

      <!-- DAILY LESSONS VIEW -->
      <section id="view-academy-lessons" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-2xl font-bold">Daily Business Lessons</h3>
              <p class="text-slate-300 mt-1">Step-by-step guidance for your 90-day journey</p>
            </div>
            <div class="text-right">
              <div class="text-sm text-slate-300">Current: Day</div>
              <div class="text-xl font-semibold" id="current-day">1</div>
            </div>
          </div>

          <!-- Lesson Navigation -->
          <div class="flex overflow-x-auto gap-2 mb-6 pb-2">
            <button class="px-4 py-2 rounded-xl bg-brand-500 whitespace-nowrap">Day 1</button>
            <button class="px-4 py-2 rounded-xl bg-white/10 whitespace-nowrap">Day 2</button>
            <button class="px-4 py-2 rounded-xl bg-white/10 whitespace-nowrap">Day 3</button>
            <button class="px-4 py-2 rounded-xl bg-white/10 whitespace-nowrap">Day 4</button>
            <button class="px-4 py-2 rounded-xl bg-white/10 whitespace-nowrap">Day 5</button>
            <button class="px-4 py-2 rounded-xl bg-white/10 whitespace-nowrap">Day 6</button>
            <button class="px-4 py-2 rounded-xl bg-white/10 whitespace-nowrap">Day 7</button>
          </div>

          <!-- Current Lesson -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2">
              <div class="glass rounded-2xl p-4 mb-4">
                <h4 class="text-xl font-semibold mb-3">Day 1: Mindset & Platform Setup</h4>
                <div class="prose prose-invert max-w-none">
                  <p class="mb-4">Welcome to your first day of business mastery. Today we're setting the foundation for everything that follows.</p>
                  
                  <div class="mentor-note p-3 rounded-lg mb-4">
                    <div class="font-semibold">ðŸŽ¯ Master's Insight:</div>
                    <div class="text-sm mt-1">Your mindset is 80% of business success. The other 20% is taking consistent action. Today we work on both.</div>
                  </div>

                  <h5 class="font-semibold mt-4 mb-2">Today's Objectives:</h5>
                  <ul class="space-y-2 mb-4">
                    <li class="flex items-start gap-2">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check" class="lucide lucide-check text-green-400 mt-0.5 flex-shrink-0"><path d="M20 6 9 17l-5-5"></path></svg>
                      <span>Shift from employee to business owner mindset</span>
                    </li>
                    <li class="flex items-start gap-2">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check" class="lucide lucide-check text-green-400 mt-0.5 flex-shrink-0"><path d="M20 6 9 17l-5-5"></path></svg>
                      <span>Complete platform customization</span>
                    </li>
                    <li class="flex items-start gap-2">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check" class="lucide lucide-check text-green-400 mt-0.5 flex-shrink-0"><path d="M20 6 9 17l-5-5"></path></svg>
                      <span>Set up your first project (even if it's a sample)</span>
                    </li>
                    <li class="flex items-start gap-2">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check" class="lucide lucide-check text-green-400 mt-0.5 flex-shrink-0"><path d="M20 6 9 17l-5-5"></path></svg>
                      <span>Create your weekly action plan</span>
                    </li>
                  </ul>

                  <h5 class="font-semibold mt-4 mb-2">Video Lesson: The Business Owner Mindset</h5>
                  <div class="aspect-video bg-black/20 rounded-xl flex items-center justify-center mb-4">
                    <div class="text-center">
                      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="play" class="lucide lucide-play mx-auto mb-2"><polygon points="6 3 20 12 6 21 6 3"></polygon></svg>
                      <div>Day 1: Business Owner Mindset (15:23)</div>
                    </div>
                  </div>

                  <h5 class="font-semibold mt-4 mb-2">Action Steps:</h5>
                  <div class="space-y-3">
                    <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg">
                      <input type="checkbox" class="rounded">
                      <div>
                        <div class="font-medium">Watch the mindset video</div>
                        <div class="text-sm text-slate-400">15 minutes - critical foundation</div>
                      </div>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg">
                      <input type="checkbox" class="rounded">
                      <div>
                        <div class="font-medium">Customize your platform</div>
                        <div class="text-sm text-slate-400">Update business name, colors, etc.</div>
                      </div>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg">
                      <input type="checkbox" class="rounded">
                      <div>
                        <div class="font-medium">Create sample project</div>
                        <div class="text-sm text-slate-400">Practice using the project system</div>
                      </div>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg">
                      <input type="checkbox" class="rounded">
                      <div>
                        <div class="font-medium">Set up weekly plan</div>
                        <div class="text-sm text-slate-400">Plan your next 7 days</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Lesson Progress & Resources -->
            <div class="space-y-4">
              <div class="glass rounded-2xl p-4">
                <h5 class="font-semibold mb-3">Your Progress</h5>
                <div class="space-y-3">
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span>Day 1 Completion</span>
                      <span>0%</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 0%"></div>
                    </div>
                  </div>
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span>Week 1 Progress</span>
                      <span>0%</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 0%"></div>
                    </div>
                  </div>
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span>Phase 1 Progress</span>
                      <span>0%</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 0%"></div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="glass rounded-2xl p-4">
                <h5 class="font-semibold mb-3">Daily Resources</h5>
                <div class="space-y-2">
                  <a href="#" class="flex items-center gap-2 p-2 hover:bg-white/5 rounded">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="download" class="lucide lucide-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y1="3"></line></svg>
                    <span>Mindset Shift Worksheet</span>
                  </a>
                  <a href="#" class="flex items-center gap-2 p-2 hover:bg-white/5 rounded">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="download" class="lucide lucide-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y1="3"></line></svg>
                    <span>Weekly Planning Template</span>
                  </a>
                  <a href="#" class="flex items-center gap-2 p-2 hover:bg-white/5 rounded">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="external-link" class="lucide lucide-external-link"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg>
                    <span>Business Owner Mindset Article</span>
                  </a>
                </div>
              </div>

              <div class="glass rounded-2xl p-4">
                <h5 class="font-semibold mb-3">Master's Notes</h5>
                <div class="text-sm space-y-2">
                  <p>"Remember: You're not building a job, you're building a business. Think systems, not tasks."</p>
                  <p>"The most successful business owners are the ones who take consistent daily action, even when they don't feel like it."</p>
                  <p>"Your first week is about building momentum. Small wins create big results."</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- CLIENT ACQUISITION VIEW -->
      <section id="view-client-acquisition" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-2xl font-bold">Client Acquisition System</h3>
              <p class="text-slate-300 mt-1">Find and convert your ideal clients</p>
            </div>
            <button class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus" class="lucide lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
              New Campaign
            </button>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Lead Generation Strategies -->
            <div class="lg:col-span-2">
              <div class="glass rounded-2xl p-4 mb-6">
                <h4 class="text-xl font-semibold mb-4">Lead Generation Strategies</h4>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                  <div class="bg-white/5 rounded-xl p-4">
                    <div class="font-semibold mb-2">Cold Outreach</div>
                    <div class="text-sm text-slate-300 mb-3">Direct messaging to potential clients</div>
                    <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm">
                      View Templates
                    </button>
                  </div>
                  <div class="bg-white/5 rounded-xl p-4">
                    <div class="font-semibold mb-2">Content Marketing</div>
                    <div class="text-sm text-slate-300 mb-3">Attract clients through valuable content</div>
                    <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm">
                      Content Plan
                    </button>
                  </div>
                  <div class="bg-white/5 rounded-xl p-4">
                    <div class="font-semibold mb-2">Referral System</div>
                    <div class="text-sm text-slate-300 mb-3">Leverage existing clients for new business</div>
                    <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm">
                      Setup Guide
                    </button>
                  </div>
                  <div class="bg-white/5 rounded-xl p-4">
                    <div class="font-semibold mb-2">Partnerships</div>
                    <div class="text-sm text-slate-300 mb-3">Collaborate with complementary businesses</div>
                    <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm">
                      Partnership Kit
                    </button>
                  </div>
                </div>

                <div class="mentor-note p-3 rounded-lg">
                  <div class="font-semibold">ðŸŽ¯ Master's Strategy:</div>
                  <div class="text-sm mt-1">Focus on ONE acquisition method for your first 30 days. Cold outreach works fastest for beginners. Send 10-15 personalized messages daily.</div>
                </div>
              </div>

              <!-- Outreach Templates -->
              <div class="glass rounded-2xl p-4">
                <h4 class="text-xl font-semibold mb-4">Outreach Templates</h4>
                
                <div class="space-y-4">
                  <div class="bg-white/5 rounded-xl p-4">
                    <div class="font-semibold mb-2">LinkedIn Connection Template</div>
                    <div class="text-sm text-slate-300 mb-3">For connecting with potential clients on LinkedIn</div>
                    <div class="bg-black/20 p-3 rounded-lg text-sm mb-3">
                      "Hi [Name], I came across your profile and was impressed by your work in [their industry]. I specialize in helping businesses like yours [specific benefit]. Would you be open to connecting?"
                    </div>
                    <button class="px-3 py-1 rounded bg-white/10 border border-white/10 hover:bg-white/20 text-sm">
                      Copy Template
                    </button>
                  </div>

                  <div class="bg-white/5 rounded-xl p-4">
                    <div class="font-semibold mb-2">Follow-up Email Template</div>
                    <div class="text-sm text-slate-300 mb-3">For following up after initial connection</div>
                    <div class="bg-black/20 p-3 rounded-lg text-sm mb-3">
                      "Hi [Name], Following up on our connection. I noticed you're [specific observation about their business]. I've helped similar companies achieve [specific result]. Would you be open to a quick 15-minute chat to explore if I could help you achieve similar results?"
                    </div>
                    <button class="px-3 py-1 rounded bg-white/10 border border-white/10 hover:bg-white/20 text-sm">
                      Copy Template
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Acquisition Dashboard -->
            <div class="space-y-6">
              <div class="glass rounded-2xl p-4">
                <h5 class="font-semibold mb-3">Acquisition Metrics</h5>
                <div class="space-y-4">
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span>Daily Outreach Goal</span>
                      <span>0/15</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 0%"></div>
                    </div>
                  </div>
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span>Weekly Calls Booked</span>
                      <span>0/5</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 0%"></div>
                    </div>
                  </div>
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span>Monthly Clients Goal</span>
                      <span>0/3</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 0%"></div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="glass rounded-2xl p-4">
                <h5 class="font-semibold mb-3">Ideal Client Profile</h5>
                <div class="space-y-3 text-sm">
                  <div>
                    <div class="text-slate-400">Industry</div>
                    <div>Small businesses, startups</div>
                  </div>
                  <div>
                    <div class="text-slate-400">Budget</div>
                    <div>$1,000 - $5,000 per project</div>
                  </div>
                  <div>
                    <div class="text-slate-400">Pain Points</div>
                    <div>Need digital presence, overwhelmed by tech</div>
                  </div>
                  <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm mt-2">
                    Edit Profile
                  </button>
                </div>
              </div>

              <div class="glass rounded-2xl p-4">
                <h5 class="font-semibold mb-3">Quick Actions</h5>
                <div class="space-y-2">
                  <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm text-left">
                    Find 10 New Prospects
                  </button>
                  <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm text-left">
                    Send Daily Outreach
                  </button>
                  <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm text-left">
                    Schedule Follow-ups
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SALES SYSTEM VIEW -->
      <section id="view-sales-system" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-2xl font-bold">Sales Conversion System</h3>
              <p class="text-slate-300 mt-1">Turn conversations into clients</p>
            </div>
            <button class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus" class="lucide lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
              New Proposal
            </button>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Sales Process -->
            <div class="lg:col-span-2">
              <div class="glass rounded-2xl p-4 mb-6">
                <h4 class="text-xl font-semibold mb-4">Sales Conversation Framework</h4>
                
                <div class="space-y-4">
                  <div class="bg-white/5 rounded-xl p-4">
                    <div class="font-semibold mb-2">1. Discovery Call Script</div>
                    <div class="text-sm text-slate-300 mb-3">Your first conversation with a potential client</div>
                    <div class="bg-black/20 p-3 rounded-lg text-sm mb-3">
                      <div class="font-semibold">Opening:</div>
                      <div>"Thanks for your time today. To make sure I respect your time, could you share what you're hoping to accomplish with [their project]?"</div>
                      <div class="font-semibold mt-2">Key Questions:</div>
                      <div>- What's not working with your current situation?</div>
                      <div>- What would success look like in 3 months?</div>
                      <div>- What's the impact if this doesn't get solved?</div>
                    </div>
                    <button class="px-3 py-1 rounded bg-white/10 border border-white/10 hover:bg-white/20 text-sm">
                      Use This Script
                    </button>
                  </div>

                  <div class="bg-white/5 rounded-xl p-4">
                    <div class="font-semibold mb-2">2. Pricing Presentation</div>
                    <div class="text-sm text-slate-300 mb-3">How to present your prices confidently</div>
                    <div class="bg-black/20 p-3 rounded-lg text-sm mb-3">
                      <div>"Based on what we discussed, I have three options that could work for you..."</div>
                      <div class="mt-2">
                        <div>Option 1: Basic ($X) - Core features</div>
                        <div>Option 2: Professional ($Y) - Most popular</div>
                        <div>Option 3: Premium ($Z) - Maximum results</div>
                      </div>
                    </div>
                    <button class="px-3 py-1 rounded bg-white/10 border border-white/10 hover:bg-white/20 text-sm">
                      Pricing Calculator
                    </button>
                  </div>

                  <div class="bg-white/5 rounded-xl p-4">
                    <div class="font-semibold mb-2">3. Handling Objections</div>
                    <div class="text-sm text-slate-300 mb-3">What to say when clients hesitate</div>
                    <div class="bg-black/20 p-3 rounded-lg text-sm mb-3">
                      <div><span class="font-semibold">"It's too expensive"</span> - "I understand. What would this solution need to be worth for you to move forward?"</div>
                      <div class="mt-2"><span class="font-semibold">"I need to think about it"</span> - "Of course. What specific information would help your decision?"</div>
                      <div class="mt-2"><span class="font-semibold">"I have another option"</span> - "That's great you're exploring options. What's most important to you in making this decision?"</div>
                    </div>
                    <button class="px-3 py-1 rounded bg-white/10 border border-white/10 hover:bg-white/20 text-sm">
                      More Responses
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Sales Dashboard -->
            <div class="space-y-6">
              <div class="glass rounded-2xl p-4">
                <h5 class="font-semibold mb-3">Sales Metrics</h5>
                <div class="space-y-4">
                  <div class="text-center p-3 bg-white/5 rounded-xl">
                    <div class="text-2xl font-semibold">0%</div>
                    <div class="text-sm text-slate-300">Conversion Rate</div>
                  </div>
                  <div class="text-center p-3 bg-white/5 rounded-xl">
                    <div class="text-2xl font-semibold">0</div>
                    <div class="text-sm text-slate-300">Calls This Week</div>
                  </div>
                  <div class="text-center p-3 bg-white/5 rounded-xl">
                    <div class="text-2xl font-semibold">$0</div>
                    <div class="text-sm text-slate-300">Pipeline Value</div>
                  </div>
                </div>
              </div>

              <div class="glass rounded-2xl p-4">
                <h5 class="font-semibold mb-3">Proposal Templates</h5>
                <div class="space-y-2">
                  <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm text-left">
                    Website Development Proposal
                  </button>
                  <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm text-left">
                    API Integration Proposal
                  </button>
                  <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm text-left">
                    Monthly Retainer Proposal
                  </button>
                  <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm text-left">
                    Custom Project Proposal
                  </button>
                </div>
              </div>

              <div class="glass rounded-2xl p-4">
                <h5 class="font-semibold mb-3">Master's Sales Tips</h5>
                <div class="text-sm space-y-2">
                  <div class="flex items-start gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="lightbulb" class="lucide lucide-lightbulb text-yellow-400 mt-0.5 flex-shrink-0"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"></path><path d="M9 18h6"></path><path d="M10 22h4"></path></svg>
                    <span>Always focus on value, not features</span>
                  </div>
                  <div class="flex items-start gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="lightbulb" class="lucide lucide-lightbulb text-yellow-400 mt-0.5 flex-shrink-0"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"></path><path d="M9 18h6"></path><path d="M10 22h4"></path></svg>
                    <span>Listen 70%, talk 30%</span>
                  </div>
                  <div class="flex items-start gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="lightbulb" class="lucide lucide-lightbulb text-yellow-400 mt-0.5 flex-shrink-0"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"></path><path d="M9 18h6"></path><path d="M10 22h4"></path></svg>
                    <span>Price anchors: show highest first</span>
                  </div>
                  <div class="flex items-start gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="lightbulb" class="lucide lucide-lightbulb text-yellow-400 mt-0.5 flex-shrink-0"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"></path><path d="M9 18h6"></path><path d="M10 22h4"></path></svg>
                    <span>Always have a clear next step</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- PROJECTS VIEW -->
      <section id="view-projects" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold">Projects</h3>
            <div class="flex items-center gap-2">
              <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openProjectModal()">New Project</button>
              <button class="px-3 py-2 rounded-xl bg-white/10 border border-white/10" onclick="downloadCSV()">Export CSV</button>
            </div>
          </div>
          <div class="overflow-auto mt-3">
            <table class="w-full text-sm table-compact">
              <thead class="text-slate-300">
                <tr>
                  <th align="left">Name</th>
                  <th align="left">Client</th>
                  <th align="left">Stack</th>
                  <th align="left">Repo</th>
                  <th align="left">Domain</th>
                  <th align="left">Status</th>
                  <th align="left">Price</th>
                  <th align="left">Due</th>
                  <th align="left">Links</th>
                  <th align="left">Actions</th>
                </tr>
              </thead>
              <tbody id="projectsTable"><tr><td colspan="10" class="text-center text-slate-400 py-4">No projects yet. Click "New Project" to get started.</td></tr></tbody>
            </table>
          </div>
        </div>
      </section>

<section id="view-portfolio" class="view-section hidden">
  <div class="view-header">
    <div>
      <h2 class="text-xl font-semibold tracking-tight">Portfolio</h2>
      <p class="mt-1 text-sm text-slate-300">
        Public-facing snapshot of selected projects. Data is read from the internal <strong>Projects</strong> table
        and only exposes non-sensitive fields (name, client label, stack, live URL and optional repo).
      </p>
    </div>
    <div class="flex items-center gap-2">
      <button class="btn-secondary text-xs" onclick="downloadPortfolioCSV()">
        Export portfolio CSV
      </button>
    </div>
  </div>

  <div class="card glass mt-4">
    <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
      <div class="max-w-2xl space-y-1">
        <h3 class="text-sm font-semibold">How this view works</h3>
        <p class="text-xs text-slate-300">
          Every row in <strong>Projects</strong> can double as a case study. This view ignores private notes,
          pricing breakdowns and any internal-only metadata, and only uses:
          project name, client label, stack, live URL / domain and optional repository link.
        </p>
      </div>
      <div class="mt-3 flex flex-col gap-1 text-xs text-slate-300 md:mt-0">
        <div class="flex items-center gap-2">
          <span class="inline-flex h-2 w-2 rounded-full bg-emerald-400"></span>
          <span>Built for sharing with leads and clients</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="inline-flex h-2 w-2 rounded-full bg-sky-400"></span>
          <span>No personal contact data is surfaced by default</span>
        </div>
      </div>
    </div>
  </div>

  <div id="portfolioGrid" class="mt-4 grid gap-4 md:grid-cols-2 xl:grid-cols-3">
    <!-- Portfolio cards will be injected here by renderPortfolio() -->
  </div>
</section>



      <!-- CLIENTS VIEW -->
      <section id="view-clients" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold">Clients</h3>
            <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openClientModal()">New Client</button>
          </div>
          <div class="overflow-auto mt-3">
            <table class="w-full text-sm table-compact">
              <thead class="text-slate-300">
                <tr><th align="left">Name</th><th align="left">Email</th><th align="left">Company</th><th align="left">Phone</th><th align="left">API Usage</th><th align="left">Actions</th></tr>
              </thead>
              <tbody id="clientsTable"><tr><td colspan="6" class="text-center text-slate-400 py-4">No clients yet. Click "New Client" to get started.</td></tr></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ORDERS & DELIVERY VIEW -->
      <section id="view-orders" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold">Orders &amp; Delivery</h3>
            <button class="px-3 py-2 rounded-xl bg-white/10 border border-white/10" onclick="openInvoiceModal()">Generate Invoice</button>
          </div>
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mt-3">
            <div class="rounded-xl p-3 bg-white/5">
              <div class="text-sm text-slate-300">Backlog</div>
              <ul id="ord-backlog" class="mt-2 space-y-1 text-sm"><div class="text-slate-400 p-2 text-center">No items</div></ul>
            </div>
            <div class="rounded-xl p-3 bg-white/5">
              <div class="text-sm text-slate-300">In Progress</div>
              <ul id="ord-progress" class="mt-2 space-y-1 text-sm"><div class="text-slate-400 p-2 text-center">No items</div></ul>
            </div>
            <div class="rounded-xl p-3 bg-white/5">
              <div class="text-sm text-slate-300">Delivered</div>
              <ul id="ord-done" class="mt-2 space-y-1 text-sm"><div class="text-slate-400 p-2 text-center">No items</div></ul>
            </div>
          </div>
        </div>
      </section>

      <!-- DEPLOYMENTS VIEW -->
      <section id="view-deployments" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold">Deployments</h3>
            <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openDeploymentModal()">New Deployment</button>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
            <div class="card glass rounded-2xl p-4">
              <div class="flex items-center justify-between mb-3">
                <div class="font-semibold">Netlify</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="cloud" class="lucide lucide-cloud"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"></path></svg>
              </div>
              <div class="text-sm text-slate-400 mb-2">Status: <span class="text-slate-400" id="netlify-status">Connect API for status</span></div>
              <div class="text-sm text-slate-400 mb-3">Sites: <span class="text-white" id="netlify-sites">-</span></div>
              <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm" onclick="connectNetlify()">Connect API</button>
            </div>
            
            <div class="card glass rounded-2xl p-4">
              <div class="flex items-center justify-between mb-3">
                <div class="font-semibold">Vercel</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="zap" class="lucide lucide-zap"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"></path></svg>
              </div>
              <div class="text-sm text-slate-400 mb-2">Status: <span class="text-slate-400" id="vercel-status">Connect API for status</span></div>
              <div class="text-sm text-slate-400 mb-3">Projects: <span class="text-white" id="vercel-projects">-</span></div>
              <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm" onclick="connectVercel()">Connect API</button>
            </div>
            
            <div class="card glass rounded-2xl p-4">
              <div class="flex items-center justify-between mb-3">
                <div class="font-semibold">GitHub Pages</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="github" class="lucide lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg>
              </div>
              <div class="text-sm text-slate-400 mb-2">Status: <span class="text-slate-400" id="github-status">Connect API for status</span></div>
              <div class="text-sm text-slate-400 mb-3">Repos: <span class="text-white" id="github-repos">-</span></div>
              <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm" onclick="connectGitHub()">Connect API</button>
            </div>
          </div>
        </div>
      </section>

      <!-- PAYMENTS VIEW -->
      <section id="view-payments" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold">Payments</h3>
            <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openPaymentModal()">Record Payment</button>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
            <div class="card glass rounded-2xl p-4">
              <div class="flex items-center justify-between mb-3">
                <div class="font-semibold">Stripe</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="credit-card" class="lucide lucide-credit-card"><rect width="20" height="14" x="2" y="5" rx="2"></rect><line x1="2" x2="22" y1="10" y2="10"></line></svg>
              </div>
              <div class="text-sm text-slate-400 mb-2">Status: <span class="text-slate-400" id="stripe-status">Connect API for status</span></div>
              <div class="text-sm text-slate-400 mb-3">Balance: <span class="text-white" id="stripe-balance">-</span></div>
              <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm" onclick="connectStripe()">Connect API</button>
            </div>
            
            <div class="card glass rounded-2xl p-4">
  <div class="flex items-center justify-between mb-3">
    <div class="font-semibold">API.market</div>
    <span class="inline-flex items-center rounded-full bg-emerald-500/10 px-2 py-0.5 text-[11px] font-medium text-emerald-300">
      Free tier ready
    </span>
  </div>
  <p class="text-xs text-slate-300 mb-3">
    Store your API.market credentials so this studio can call marketplace endpoints securely without hard-coding keys
    into every micro-app or demo.
  </p>
  <div class="space-y-3">
    <div>
      <label class="block text-[11px] font-medium text-slate-300 mb-1">Public key</label>
      <div class="flex gap-2">
        <input id="apiMarketPublicKey" type="password" placeholder="apimkt_pk_..." class="flex-1 rounded-lg border border-slate-700/80 bg-slate-900/60 px-3 py-1.5 text-xs" />
        <button class="btn-primary text-xs px-3" onclick="saveToken('apiMarketPublicKey')">Save</button>
      </div>
    </div>
    <div>
      <label class="block text-[11px] font-medium text-slate-300 mb-1">Secret key</label>
      <div class="flex gap-2">
        <input id="apiMarketSecretKey" type="password" placeholder="apimkt_sk_..." class="flex-1 rounded-lg border border-slate-700/80 bg-slate-900/60 px-3 py-1.5 text-xs" />
        <button class="btn-secondary text-xs px-3" onclick="saveToken('apiMarketSecretKey')">Save</button>
      </div>
    </div>
  </div>
</div>

<div class="card glass rounded-2xl p-4">
              <div class="flex items-center justify-between mb-3">
                <div class="font-semibold">PayPal</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="wallet" class="lucide lucide-wallet"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"></path><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"></path></svg>
              </div>
              <div class="text-sm text-slate-400 mb-2">Status: <span class="text-slate-400" id="paypal-status">Connect API for status</span></div>
              <div class="text-sm text-slate-400 mb-3">Balance: <span class="text-white" id="paypal-balance">-</span></div>
              <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm" onclick="connectPayPal()">Connect API</button>
            </div>
          </div>
          
          <div class="mt-6 glass rounded-2xl p-4">
            <h4 class="font-semibold mb-3">Recent Transactions</h4>
            <div class="overflow-auto">
              <table class="w-full text-sm table-compact">
                <thead class="text-slate-300">
                  <tr><th align="left">Date</th><th align="left">Description</th><th align="left">Amount</th><th align="left">Status</th></tr>
                </thead>
                <tbody id="paymentsTable"><tr><td colspan="4" class="text-center text-slate-400 py-4">No transactions yet.</td></tr></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- DOMAINS VIEW -->
      <section id="view-domains" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold">Domains</h3>
            <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openDomainModal()">Add Domain</button>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4" id="domainsGrid">
            <div class="card glass rounded-2xl p-4 text-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="globe" class="lucide lucide-globe mx-auto mb-4 text-slate-400"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path d="M2 12h20"></path></svg>
              <h3 class="text-lg font-semibold mb-2">No Domains Added</h3>
              <p class="text-slate-400 mb-4">Add your first domain to get started</p>
              <button class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openDomainModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus" class="lucide lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
                Add Your First Domain
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- API INVENTORY VIEW -->
      <section id="view-api-inventory" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold">API Credit Inventory</h3>
            <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openApiModal()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus" class="lucide lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
              Add API Key
            </button>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 mt-4" id="apiGrid">
            <div class="col-span-full glass rounded-2xl p-6 text-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="key" class="lucide lucide-key mx-auto mb-4 text-slate-400"><path d="m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4"></path><path d="m21 2-9.6 9.6"></path><circle cx="7.5" cy="15.5" r="5.5"></circle></svg>
              <h3 class="text-lg font-semibold mb-2">No API Keys Added</h3>
              <p class="text-slate-400 mb-4">Add your first API key to start tracking usage and profits</p>
              <button class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openApiModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus" class="lucide lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
                Add Your First API Key
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- CONTENT STUDIO VIEW -->
      <section id="view-content-studio" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">Content Studio</h3>
            <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="ContentStudio.generateContent()">Generate Content</button>
          </div>

          <!-- Enhanced Content Quality Controls -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <div class="glass rounded-2xl p-4">
              <h4 class="font-semibold mb-3">Content Generator</h4>
              <div class="space-y-3">
                <div>
                  <label class="block text-sm text-slate-300 mb-1">Content Type</label>
                  <select class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" id="contentType">
                    <option value="social">Social Media Post</option>
                    <option value="blog">Blog Article</option>
                    <option value="email">Email Newsletter</option>
                    <option value="ad">Ad Copy</option>
                    <option value="video">Video Script</option>
                    <option value="press">Press Release</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm text-slate-300 mb-1">Social Network</label>
                  <select class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" id="socialNetwork">
                    <option value="facebook">Facebook</option>
                    <option value="twitter">Twitter/X</option>
                    <option value="instagram">Instagram</option>
                    <option value="linkedin">LinkedIn</option>
                    <option value="tiktok">TikTok</option>
                    <option value="pinterest">Pinterest</option>
                    <option value="youtube">YouTube</option>
                    <option value="reddit">Reddit</option>
                    <option value="snapchat">Snapchat</option>
                    <option value="whatsapp">WhatsApp</option>
                    <option value="telegram">Telegram</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm text-slate-300 mb-1">Topic/Theme</label>
                  <input type="text" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" id="contentTopic" placeholder="e.g., AI APIs, Web Development">
                </div>
                
                <div>
                  <label class="block text-sm text-slate-300 mb-1">Tone</label>
                  <select class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" id="contentTone">
                    <option value="professional">Professional</option>
                    <option value="casual">Casual</option>
                    <option value="enthusiastic">Enthusiastic</option>
                    <option value="humorous">Humorous</option>
                    <option value="inspirational">Inspirational</option>
                    <option value="authoritative">Authoritative</option>
                  </select>
                </div>
                
                <!-- Enhanced Quality Controls -->
                <div>
                  <label class="block text-sm text-slate-300 mb-1">Viral Energy <span id="viralValue" class="text-brand-300">5</span>/10</label>
                  <input type="range" min="1" max="10" value="5" class="w-full" id="viralEnergy">
                  <div class="text-xs text-slate-400 mt-1">Higher = more engaging & shareable</div>
                </div>
                
                <div>
                  <label class="block text-sm text-slate-300 mb-1">Content Length</label>
                  <select class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" id="contentLength">
                    <option value="short">Short & Punchy</option>
                    <option value="medium" selected>Medium</option>
                    <option value="long">Long & Comprehensive</option>
                    <option value="detailed">Very Detailed</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm text-slate-300 mb-1">Hashtag Strategy</label>
                  <select class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" id="hashtagStrategy">
                    <option value="minimal">Minimal (1-2)</option>
                    <option value="balanced" selected>Balanced (3-5)</option>
                    <option value="trending">Trending Focused</option>
                    <option value="maximal">Maximum Reach</option>
                  </select>
                </div>
                
                <button class="w-full px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600 flex items-center justify-center gap-2" onclick="ContentStudio.generateContent()" id="generateContentBtn">
                  Generate Premium Content
                </button>
              </div>
            </div>
            
            <div class="glass rounded-2xl p-4">
              <h4 class="font-semibold mb-3">Generated Content</h4>
              <div id="content-output" class="bg-white/5 rounded-xl p-4 min-h-[200px]">
                <p class="text-slate-400 text-center">Your generated content will appear here</p>
              </div>
              
              <!-- Quality Metrics -->
              <div id="qualityMetrics" class="hidden mt-3 grid grid-cols-3 gap-2 text-center">
                <div class="bg-white/5 rounded p-2">
                  <div class="text-xs text-slate-400">Quality Score</div>
                  <div id="qualityScore" class="text-lg font-semibold">-</div>
                </div>
                <div class="bg-white/5 rounded p-2">
                  <div class="text-xs text-slate-400">Engagement</div>
                  <div id="engagementScore" class="text-lg font-semibold">-</div>
                </div>
                <div class="bg-white/5 rounded p-2">
                  <div class="text-xs text-slate-400">Time Saved</div>
                  <div id="timeSaved" class="text-lg font-semibold">-</div>
                </div>
              </div>
              
              <div class="flex gap-2 mt-3">
                <button class="flex-1 px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20" onclick="ContentStudio.copyContent()">Copy</button>
                <button class="flex-1 px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20" onclick="ContentStudio.saveContent()">Save</button>
                <button class="flex-1 px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20" onclick="ContentStudio.schedulePost()">Schedule</button>
              </div>
            </div>
            
            <!-- Service Packages Panel -->
            <div class="glass rounded-2xl p-4">
              <h4 class="font-semibold mb-3">Service Packages</h4>
              <div class="space-y-3">
                <div class="bg-white/5 rounded-xl p-3 border border-brand-500/30">
                  <div class="flex justify-between items-start mb-2">
                    <div>
                      <div class="font-semibold">Starter Package</div>
                      <div class="text-sm text-slate-400">10 content pieces</div>
                    </div>
                    <div class="text-lg font-bold text-brand-300">$997</div>
                  </div>
                  <button class="w-full px-3 py-2 rounded-xl bg-brand-500/20 text-brand-200 border border-brand-500/30 hover:bg-brand-500/30 text-sm" onclick="ServicePackages.selectPackage('starter')">
                    Select Package
                  </button>
                </div>
                
                <div class="bg-white/5 rounded-xl p-3 border border-brand-500/30">
                  <div class="flex justify-between items-start mb-2">
                    <div>
                      <div class="font-semibold">Professional Package</div>
                      <div class="text-sm text-slate-400">30 content pieces + strategy</div>
                    </div>
                    <div class="text-lg font-bold text-brand-300">$1,997</div>
                  </div>
                  <button class="w-full px-3 py-2 rounded-xl bg-brand-500/20 text-brand-200 border border-brand-500/30 hover:bg-brand-500/30 text-sm" onclick="ServicePackages.selectPackage('professional')">
                    Select Package
                  </button>
                </div>
                
                <div class="bg-white/5 rounded-xl p-3 border border-brand-500/30">
                  <div class="flex justify-between items-start mb-2">
                    <div>
                      <div class="font-semibold">Enterprise Package</div>
                      <div class="text-sm text-slate-400">Unlimited + analytics</div>
                    </div>
                    <div class="text-lg font-bold text-brand-300">$3,997</div>
                  </div>
                  <button class="w-full px-3 py-2 rounded-xl bg-brand-500/20 text-brand-200 border border-brand-500/30 hover:bg-brand-500/30 text-sm" onclick="ServicePackages.selectPackage('enterprise')">
                    Select Package
                  </button>
                </div>
                
                <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm" onclick="ServicePackages.openCustomBuilder()">
                  Build Custom Package
                </button>
              </div>
            </div>
          </div>

          <!-- Content Performance Analytics -->
          <div class="mt-6 glass rounded-2xl p-4">
            <h4 class="font-semibold mb-3">Content Performance</h4>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
              <div class="text-center p-4 bg-white/5 rounded-xl">
                <div class="text-2xl font-semibold" id="totalGenerated">0</div>
                <div class="text-sm text-slate-300">Total Generated</div>
              </div>
              <div class="text-center p-4 bg-white/5 rounded-xl">
                <div class="text-2xl font-semibold" id="avgQuality">-</div>
                <div class="text-sm text-slate-300">Avg Quality</div>
              </div>
              <div class="text-center p-4 bg-white/5 rounded-xl">
                <div class="text-2xl font-semibold" id="moneyEarned">$0</div>
                <div class="text-sm text-slate-300">Money Earned</div>
              </div>
              <div class="text-center p-4 bg-white/5 rounded-xl">
                <div class="text-2xl font-semibold" id="timeSavedTotal">0h</div>
                <div class="text-sm text-slate-300">Time Saved</div>
              </div>
            </div>
          </div>

          <div class="mt-6 glass rounded-2xl p-4">
            <h4 class="font-semibold mb-3">Content Calendar</h4>
            <div class="grid grid-cols-1 md:grid-cols-7 gap-2 text-center">
              <div class="text-xs text-slate-400 p-2">Mon</div>
              <div class="text-xs text-slate-400 p-2">Tue</div>
              <div class="text-xs text-slate-400 p-2">Wed</div>
              <div class="text-xs text-slate-400 p-2">Thu</div>
              <div class="text-xs text-slate-400 p-2">Fri</div>
              <div class="text-xs text-slate-400 p-2">Sat</div>
              <div class="text-xs text-slate-400 p-2">Sun</div>
              
              <!-- Calendar days would be populated here -->
              <div class="col-span-7 text-slate-400 p-4 text-center">No content scheduled yet</div>
            </div>
          </div>
        </div>
      </section>

      <!-- REVENUE & GOALS VIEW -->
      <section id="view-revenue" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">Revenue & Goals</h3>
            <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="RevenueManager.addRevenue()">Add Revenue</button>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="card glass rounded-2xl p-4">
              <div class="text-slate-300 text-sm">Monthly Revenue</div>
              <div class="text-3xl font-semibold mt-1" id="revenue-current">-</div>
              <div class="mt-3 h-2 bg-white/10 rounded-full overflow-hidden">
                <div id="revenue-progress" class="h-full bg-brand-500" style="width: 0%"></div>
              </div>
            </div>
            
            <div class="card glass rounded-2xl p-4">
              <div class="text-slate-300 text-sm">Monthly Goal</div>
              <div class="text-3xl font-semibold mt-1" id="revenue-goal">-</div>
              <div class="mt-3 text-xs text-slate-300" id="revenue-status">Set goal to begin tracking</div>
            </div>
            
            <div class="card glass rounded-2xl p-4">
              <div class="text-slate-300 text-sm">YTD Revenue</div>
              <div class="text-3xl font-semibold mt-1" id="revenue-ytd">-</div>
              <div class="mt-3 text-xs text-slate-300">Year to Date</div>
            </div>
            
            <div class="card glass rounded-2xl p-4">
              <div class="text-slate-300 text-sm">Projected Annual</div>
              <div class="text-3xl font-semibold mt-1" id="revenue-projected">-</div>
              <div class="mt-3 text-xs text-slate-300">Based on current pace</div>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass rounded-2xl p-4">
              <h4 class="font-semibold mb-3">Revenue Sources</h4>
              <div id="revenue-sources" class="space-y-2">
                <div class="text-slate-400 text-center p-4">No revenue sources added yet</div>
              </div>
              <button class="mt-3 w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20" 
                      onclick="RevenueManager.addRevenueSource()">Add Revenue Source</button>
            </div>
            
            <div class="glass rounded-2xl p-4">
              <h4 class="font-semibold mb-3">Goal Settings</h4>
              <div class="space-y-3">
                <div>
                  <label class="block text-sm text-slate-300 mb-1">Monthly Goal ($)</label>
                  <input type="number" id="goal-amount" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" placeholder="Set monthly goal">
                </div>
                <div>
                  <label class="block text-sm text-slate-300 mb-1">Auto-increase Goal</label>
                  <select id="goal-auto-increase" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
                    <option value="true">Yes - Double when reached</option>
                    <option value="false">No - Keep fixed goal</option>
                  </select>
                </div>
                <button class="w-full px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" 
                        onclick="RevenueManager.updateGoal()">Update Goal</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ADS & AFFILIATES VIEW -->
      <section id="view-ads" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">Ads & Affiliates</h3>
            <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="AdsManager.addAffiliate()">Add Affiliate</button>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="glass rounded-2xl p-4">
              <h4 class="font-semibold mb-3">Affiliate Programs</h4>
              <div id="affiliate-list" class="space-y-3">
                <div class="text-slate-400 text-center p-4">No affiliate programs added yet</div>
              </div>
            </div>
            
            <div class="glass rounded-2xl p-4">
              <h4 class="font-semibold mb-3">Link Generator</h4>
              <div class="space-y-3">
                <div>
                  <label class="block text-sm text-slate-300 mb-1">Original URL</label>
                  <input type="url" id="affiliate-url" placeholder="https://example.com/event" 
                         class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
                </div>
                <div>
                  <label class="block text-sm text-slate-300 mb-1">Affiliate Program</label>
                  <select id="affiliate-program" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
                    <option value="">Select a program</option>
                  </select>
                </div>
                <button class="w-full px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" 
                        onclick="AdsManager.generateAffiliateLink()">Generate Link</button>
                <div id="affiliate-result" class="mt-3 p-3 bg-white/5 rounded-xl hidden">
                  <div class="text-sm text-slate-300">Your affiliate link:</div>
                  <div id="generated-link" class="text-sm break-all mt-1"></div>
                  <button class="mt-2 px-3 py-1 rounded bg-white/10 border border-white/10 hover:bg-white/20 text-xs" 
                          onclick="AdsManager.copyAffiliateLink()">Copy</button>
                </div>
              </div>
            </div>
          </div>

          <div class="glass rounded-2xl p-4">
            <h4 class="font-semibold mb-3">Ad Performance</h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="text-center p-4 bg-white/5 rounded-xl">
                <div class="text-2xl font-semibold" id="ad-impressions">-</div>
                <div class="text-sm text-slate-300">Impressions</div>
              </div>
              <div class="text-center p-4 bg-white/5 rounded-xl">
                <div class="text-2xl font-semibold" id="ad-clicks">-</div>
                <div class="text-sm text-slate-300">Clicks</div>
              </div>
              <div class="text-center p-4 bg-white/5 rounded-xl">
                <div class="text-2xl font-semibold" id="ad-conversion">-</div>
                <div class="text-sm text-slate-300">Conversion Rate</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- AI & APIs VIEW -->
      <section id="view-ai-apis" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">AI & APIs</h3>
            <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openAIApiModal()">Add AI Service</button>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="aiServicesGrid">
            <div class="card glass rounded-2xl p-4 text-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="brain" class="lucide lucide-brain mx-auto mb-4 text-slate-400"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"></path><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"></path><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"></path><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"></path><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"></path><path d="M3.477 10.896a4 4 0 0 1 .585-.396"></path><path d="M19.938 10.5a4 4 0 0 1 .585.396"></path><path d="M6 18a4 4 0 0 1-1.967-.516"></path><path d="M19.967 17.484A4 4 0 0 1 18 18"></path></svg>
              <h3 class="text-lg font-semibold mb-2">No AI Services Added</h3>
              <p class="text-slate-400 mb-4">Add your first AI service to get started</p>
              <button class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openAIApiModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus" class="lucide lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
                Add Your First AI Service
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- FILE MANAGER VIEW -->
      <section id="view-file-manager" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold">File Manager</h3>
            <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openFileUploadModal()">Upload File</button>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
            <div class="card glass rounded-2xl p-4 text-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="folder" class="lucide lucide-folder mx-auto mb-4 text-slate-400"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"></path></svg>
              <h3 class="text-lg font-semibold mb-2">Projects</h3>
              <p class="text-slate-400 mb-4">Project files and assets</p>
              <button class="px-4 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20">Open</button>
            </div>
            
            <div class="card glass rounded-2xl p-4 text-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="image" class="lucide lucide-image mx-auto mb-4 text-slate-400"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><circle cx="9" cy="9" r="2"></circle><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path></svg>
              <h3 class="text-lg font-semibold mb-2">Images</h3>
              <p class="text-slate-400 mb-4">Graphics and photos</p>
              <button class="px-4 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20">Open</button>
            </div>
            
            <div class="card glass rounded-2xl p-4 text-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="file-text" class="lucide lucide-file-text mx-auto mb-4 text-slate-400"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="M10 9H8"></path><path d="M16 13H8"></path><path d="M16 17H8"></path></svg>
              <h3 class="text-lg font-semibold mb-2">Documents</h3>
              <p class="text-slate-400 mb-4">PDFs and text files</p>
              <button class="px-4 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20">Open</button>
            </div>
            
            <div class="card glass rounded-2xl p-4 text-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="archive" class="lucide lucide-archive mx-auto mb-4 text-slate-400"><rect width="20" height="5" x="2" y="3" rx="1"></rect><path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8"></path><path d="M10 12h4"></path></svg>
              <h3 class="text-lg font-semibold mb-2">Archives</h3>
              <p class="text-slate-400 mb-4">Backups and exports</p>
              <button class="px-4 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20">Open</button>
            </div>
          </div>
        </div>
      </section>

      <!-- REMINDERS VIEW -->
      <section id="view-reminders" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold">Reminders & Alarms</h3>
            <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openReminderModal()">New Reminder</button>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
            <div class="card glass rounded-2xl p-4 text-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="alarm-clock" class="lucide lucide-alarm-clock mx-auto mb-4 text-slate-400"><circle cx="12" cy="13" r="8"></circle><path d="M12 9v4l2 2"></path><path d="M5 3 2 6"></path><path d="m22 6-3-3"></path><path d="M6.38 18.7 4 21"></path><path d="M17.64 18.67 20 21"></path></svg>
              <h3 class="text-lg font-semibold mb-2">No Reminders Set</h3>
              <p class="text-slate-400 mb-4">Add your first reminder to get started</p>
              <button class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openReminderModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus" class="lucide lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
                Add Your First Reminder
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- INTEGRATIONS VIEW -->
      <section id="view-integrations" class="view">
        <div class="glass rounded-2xl p-4">
          <h3 class="text-lg font-semibold mb-2">Integrations Vault</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3">
            <div class="card bg-white/5 rounded-2xl p-4">
              <div class="flex items-center justify-between">
                <div class="font-semibold">GitHub</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="github" class="lucide lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg>
              </div>
              <input id="githubToken" type="password" placeholder="GitHub PAT (repo scope)" class="w-full mt-2 bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
              <button class="mt-2 px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="saveToken('githubToken')">Save</button>
            </div>

            <div class="card bg-white/5 rounded-2xl p-4">
              <div class="flex items-center justify-between">
                <div class="font-semibold">Netlify</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="cloud" class="lucide lucide-cloud"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"></path></svg>
              </div>
              <input id="netlifyToken2" type="password" placeholder="Netlify Token (mirror)" class="w-full mt-2 bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
              <button class="mt-2 px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="saveToken('netlifyToken2')">Save</button>
            </div>

            <div class="card bg-white/5 rounded-2xl p-4">
              <div class="flex items-center justify-between">
                <div class="font-semibold">Stripe</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="credit-card" class="lucide lucide-credit-card"><rect width="20" height="14" x="2" y="5" rx="2"></rect><line x1="2" x2="22" y1="10" y2="10"></line></svg>
              </div>
              <input id="stripePK" placeholder="Stripe Publishable Key" class="w-full mt-2 bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
              <button class="mt-2 px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="saveToken('stripePK')">Save</button>
            </div>

            <div class="card bg-white/5 rounded-2xl p-4">
              <div class="flex items-center justify-between">
                <div class="font-semibold">OpenAI</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="brain" class="lucide lucide-brain"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"></path><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"></path><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"></path><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"></path><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"></path><path d="M3.477 10.896a4 4 0 0 1 .585-.396"></path><path d="M19.938 10.5a4 4 0 0 1 .585.396"></path><path d="M6 18a4 4 0 0 1-1.967-.516"></path><path d="M19.967 17.484A4 4 0 0 1 18 18"></path></svg>
              </div>
              <input id="openaiKey" type="password" placeholder="OpenAI API Key" class="w-full mt-2 bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
              <button class="mt-2 px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="saveToken('openaiKey')">Save</button>
            </div>

            <div class="card bg-white/5 rounded-2xl p-4">
              <div class="flex items-center justify-between">
                <div class="font-semibold">PayPal</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="wallet" class="lucide lucide-wallet"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"></path><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"></path></svg>
              </div>
              <input id="paypalClientId" placeholder="PayPal Client ID" class="w-full mt-2 bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
              <button class="mt-2 px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="saveToken('paypalClientId')">Save</button>
            </div>

            <div class="card bg-white/5 rounded-2xl p-4">
              <div class="flex items-center justify-between">
                <div class="font-semibold">Plausible Analytics</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="bar-chart-3" class="lucide lucide-bar-chart-3"><path d="M3 3v16a2 2 0 0 0 2 2h16"></path><path d="M18 17V9"></path><path d="M13 17V5"></path><path d="M8 17v-3"></path></svg>
              </div>
              <input id="plausibleSite" placeholder="Site Domain (example.com)" class="w-full mt-2 bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
              <button class="mt-2 px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="saveToken('plausibleSite')">Save</button>
            </div>
          </div>
        </div>
      </section>

      <!-- DOCS & TEMPLATES VIEW -->
      <section id="view-docs" class="view">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold">Docs & Templates</h3>
            <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openDocModal()">New Document</button>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
            <div class="card glass rounded-2xl p-4">
              <div class="flex items-center justify-between mb-3">
                <div class="font-semibold">Project Proposal</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="file-text" class="lucide lucide-file-text"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="M10 9H8"></path><path d="M16 13H8"></path><path d="M16 17H8"></path></svg>
              </div>
              <div class="text-sm text-slate-400 mb-3">Standard project proposal template</div>
              <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm">Use Template</button>
            </div>
            
            <div class="card glass rounded-2xl p-4">
              <div class="flex items-center justify-between mb-3">
                <div class="font-semibold">Invoice Template</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="receipt" class="lucide lucide-receipt"><path d="M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z"></path><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"></path><path d="M12 17.5v-11"></path></svg>
              </div>
              <div class="text-sm text-slate-400 mb-3">Professional invoice template</div>
              <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm">Use Template</button>
            </div>
            
            <div class="card glass rounded-2xl p-4">
              <div class="flex items-center justify-between mb-3">
                <div class="font-semibold">Contract Agreement</div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="file-check" class="lucide lucide-file-check"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="m9 15 2 2 4-4"></path></svg>
              </div>
              <div class="text-sm text-slate-400 mb-3">Client service agreement</div>
              <button class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm">Use Template</button>
            </div>
          </div>
        </div>
      </section>

      <!-- SETTINGS VIEW -->
      <section id="view-settings" class="view">
        <div class="glass rounded-2xl p-4">
          <h3 class="text-lg font-semibold">Settings</h3>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mt-3">
            <!-- Background controls -->
            <div class="bg-white/5 rounded-2xl p-4">
              <div class="font-semibold">Background</div>
              <div class="mt-2 grid grid-cols-2 gap-2">
                <label class="flex items-center gap-2"><input type="radio" name="bgType" value="gradient" checked> Gradient</label>
                <label class="flex items-center gap-2"><input type="radio" name="bgType" value="image"> JPG/PNG</label>
                <label class="flex items-center gap-2"><input type="radio" name="bgType" value="gif"> GIF</label>
                <label class="flex items-center gap-2"><input id="kenToggle" type="checkbox" checked> Ken Burns effect</label>
              </div>
              <div class="mt-3">
                <input id="bgUrl" placeholder="Paste image/GIF URLâ€¦" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
                <div class="text-xs text-slate-300 mt-1">Leave empty for gradient.</div>
              </div>
              <div class="mt-2 flex gap-2">
                <button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="applyBackground()">Apply</button>
                <button class="px-3 py-2 rounded-xl bg-white/10 border border-white/10" onclick="resetBackground()">Reset</button>
              </div>
            </div>

            <!-- Business info -->
            <div class="bg-white/5 rounded-2xl p-4">
              <div class="font-semibold">Business Profile</div>
              <div class="grid grid-cols-2 gap-2 mt-2">
                <input id="bizName" placeholder="Business Name" class="bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
                <input id="bizEmail" placeholder="Billing Email" class="bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
                <input id="bizCurrency" placeholder="Currency (USD/EURâ€¦)" class="bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
                <input id="bizAddress" placeholder="Address" class="bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
              </div>
              <div class="mt-2"><button class="px-3 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="saveBusiness()">Save</button></div>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- MODALS -->
  <div id="modal" class="fixed inset-0 items-center justify-center p-4 hidden">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="relative w-full max-w-2xl glass rounded-2xl p-4">
      <div class="flex items-center justify-between">
        <h3 id="modalTitle" class="text-lg font-semibold">Edit Project</h3>
        <button onclick="closeModal()" class="h-10 w-10 rounded-xl hover:bg-white/10 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button>
      </div>
      <div id="modalBody" class="mt-3">
        <!-- Modal content will be populated dynamically -->
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script>
    // ---------- State ----------
    const LS_KEY = "omniStudioCompleteState.v3";

    const state = loadState() || {
      projects: [],
      clients: [],
      orders: [],
      notes: "",
      apis: [],
      aiServices: [],
      domains: [],
      contentHistory: [],
      servicePackages: {
        starter: { price: 997, contentPieces: 10 },
        professional: { price: 1997, contentPieces: 30 },
        enterprise: { price: 3997, contentPieces: -1 }
      },
      contentStats: {
        totalGenerated: 0,
        totalRevenue: 0,
        totalTimeSaved: 0,
        avgQuality: 0
      },
      academy: {
        currentDay: 1,
        currentPhase: 1,
        completedLessons: [],
        dailyActions: {},
        revenueGoal: 1000,
        clientGoal: 3,
        startDate: new Date().toISOString()
      },
      apiMarket: {
        connected: false,
        apiKey: '',
        storeSlug: '',
        listedProducts: [],
        providers: [],
        usage: {}
      },
      integrations: {
        netlifyToken: "",
        githubToken: "",
        cloudflareToken: "",
        paypalClientId: "",
        stripePK: "",
        google: { clientId: "", redirect: "" },
        uptimeKey: "",
        plausibleSite: "",
        apiMarketKey: "",
        openaiKey: ""
      },
      business: { name: "", email: "", currency: "USD", address: "" },
      settings: { theme: "dark", bgType: "gradient", bgUrl: "", ken: true },
      version: 3
    };

    function loadState(){ 
      try { 
        const saved = localStorage.getItem(LS_KEY);
        return saved ? JSON.parse(saved) : null;
      } catch(e){ 
        console.error("Error loading state:", e);
        return null; 
      }
    }
    
    function saveState(){ 
      try {
        localStorage.setItem(LS_KEY, JSON.stringify(state)); 
      } catch(e) {
        console.error("Error saving state:", e);
      }
    }

    // ---------- UI Basics ----------
    const views = [
      "dashboard","projects","clients","orders","deployments","payments","domains",
      "api-inventory","content-studio","revenue","ads","ai-apis","file-manager",
      "reminders","integrations","docs","settings","academy-dashboard","academy-lessons",
      "client-acquisition","sales-system"
    ];
    
    function openView(id){
      views.forEach(v => document.getElementById("view-"+v)?.classList?.toggle("active", v===id));
      document.querySelectorAll(".nav-btn").forEach(b => b.classList.toggle("bg-white/10", b.dataset.view===id));
      if (id==="dashboard") renderDashboard();
      if (id==="projects") renderProjects();
      if (id==="portfolio") renderPortfolio();
      if (id==="clients") renderClients();
      if (id==="orders") renderOrders();
      if (id==="api-inventory") renderApiInventory();
      if (id==="ai-apis") renderAIServices();
      if (id==="domains") renderDomains();
      if (id==="content-studio") renderContentStats();
      if (id==="academy-dashboard") renderAcademyDashboard();
      if (id==="academy-lessons") renderAcademyLessons();
      if (id==="client-acquisition") renderClientAcquisition();
      if (id==="sales-system") renderSalesSystem();
    }

    document.getElementById("openNav").addEventListener("click", () => {
      document.querySelector("aside").classList.toggle("hidden");
      document.querySelector("aside").classList.toggle("flex");
    });

    // ---------- Theme ----------
    function applyTheme(){
      const dark = state.settings.theme === "dark";
      document.body.classList.toggle("text-slate-100", dark);
      document.body.classList.toggle("bg-skyink", dark);
      const aside = document.querySelector("aside");
      if (aside) {
        aside.classList.toggle("glass", dark);
        aside.classList.toggle("glass-light", !dark);
      }
      document.getElementById("themeToggle").checked = !dark;
    }
    
    document.getElementById("themeToggle").addEventListener("change", (e)=>{
      state.settings.theme = e.target.checked ? "light" : "dark";
      saveState(); 
      applyTheme();
    });

    // ---------- Background ----------
    function applyBackground(first=false){
      const type = document.querySelector('input[name="bgType"]:checked')?.value || state.settings.bgType;
      const url = document.getElementById("bgUrl").value || state.settings.bgUrl;
      const ken = document.getElementById("kenToggle").checked;
      state.settings.bgType = type; 
      state.settings.bgUrl = url; 
      state.settings.ken = ken; 
      saveState();

      const img = document.getElementById("bg-img");
      img.classList.add("hidden");
      img.classList.remove("animate-kenburns-slow");
      
      if (type === "gradient" || !url){
        // gradient only
      } else {
        img.src = url;
        img.onload = () => {
          img.classList.remove("hidden");
          if (ken) img.classList.add("animate-kenburns-slow");
        };
        img.onerror = () => { console.error("Background image failed to load."); };
      }
      
      if (!first){
        document.querySelectorAll('input[name="bgType"]').forEach(r=>r.checked = (r.value===type));
        document.getElementById("bgUrl").value = url || "";
        document.getElementById("kenToggle").checked = ken;
      }
    }
    
    function resetBackground(){
      state.settings.bgType = "gradient"; 
      state.settings.bgUrl = ""; 
      state.settings.ken = true;
      saveState(); 
      applyBackground();
    }

    // ---------- Business Academy ----------
    function renderAcademyDashboard() {
      document.getElementById("current-phase").textContent = getCurrentPhase();
      document.getElementById("academy-days").textContent = state.academy.currentDay;
      document.getElementById("academy-lessons").textContent = state.academy.completedLessons.length;
      document.getElementById("academy-clients").textContent = state.clients.length;
      document.getElementById("academy-revenue").textContent = "$" + calculateTotalRevenue();
      
      // Update progress bars
      updateProgressBars();
    }
    
    function renderAcademyLessons() {
      try {
        const day = state.academy.currentDay || 1;
        const phase = state.academy.currentPhase || 1;
        const dailyActions = state.academy.dailyActions || {};
        const key = `day_${day}`;
        const completed = dailyActions[key] || [];

        const dayTitleEl = document.getElementById("current-day");
        if (dayTitleEl) dayTitleEl.textContent = day;

        const container = document.getElementById("academyLessonsContainer");
        if (!container) return;

        // Simple curriculum map aligned with your 3 phases
        const curriculum = {
          1: {
            phaseName: "Foundation â€“ First $1,000",
            focus: "Build offer, portfolio and first clients.",
            tasks: [
              "Define 1â€“2 service packages you will sell.",
              "Create or refine your social profiles where you will sell.",
              "Finish at least 1 real portfolio asset (before/after, case, demo).",
              "Publish 1 short social post generated with the Content Studio.",
              "Make a list of 20 potential leads (people, pages or businesses)."
            ]
          },
          2: {
            phaseName: "Systemize â€“ Consistent $3,000/Month",
            focus: "Stabilize lead flow and delivery.",
            tasks: [
              "Map your client journey: lead â†’ DM â†’ call â†’ payment â†’ delivery.",
              "Document a simple SOP for how you deliver your main service.",
              "Create a basic waitlist form (Google Form / Typeform / Notion).",
              "Increase your prices in the app and write a new positioning post.",
              "Identify 1 task you can delegate or automate this week."
            ]
          },
          3: {
            phaseName: "Scale â€“ Passive Income Foundation",
            focus: "Convert knowâ€‘how into products.",
            tasks: [
              "Define your first digital product (template, miniâ€‘course, toolkit).",
              "Outline the 3â€“5 modules or sections of that product.",
              "Draft 3 promotional posts for your new premium / product offer.",
              "List 2 people you could collaborate with for reach or distribution.",
              "Write a simple \"exit strategy\" note: what you want this business to fund in your life."
            ]
          }
        };

        const phaseCfg = curriculum[phase] || curriculum[1];

        // Render phase header and tasks with checkboxes
        container.innerHTML = `
          <div class="mb-4">
            <div class="text-xs uppercase tracking-wide text-brand-300 mb-1">Phase ${phase}: ${phaseCfg.phaseName}</div>
            <div class="text-sm text-slate-300 mb-1">${phaseCfg.focus}</div>
            <div class="text-xs text-slate-400">Day ${day} of 90 â€¢ Complete the checkâ€‘list below before moving on.</div>
          </div>
          <div class="space-y-2">
            ${phaseCfg.tasks.map((task, idx) => {
              const id = `${key}_task_${idx}`;
              const checked = completed.includes(id);
              return `
                <label class="daily-task flex items-center gap-3 p-2 hover:bg-white/5 rounded cursor-pointer">
                  <input type="checkbox" class="rounded" data-day-key="${key}" data-task-id="${id}" ${checked ? "checked" : ""}>
                  <span class="text-sm">${task}</span>
                </label>
              `;
            }).join("")}
          </div>
          <div class="mt-4 flex items-center justify-between text-xs text-slate-400">
            <button id="academyPrevDay" class="px-3 py-1 rounded-lg border border-white/10 hover:bg-white/5">&larr; Previous Day</button>
            <div id="academyProgressNote"></div>
            <button id="academyNextDay" class="px-3 py-1 rounded-lg bg-brand-500 hover:bg-brand-600 text-xs">Mark Day Complete &rarr;</button>
          </div>
        `;

        // Attach checkbox handlers
        container.querySelectorAll("input[type='checkbox'][data-day-key]").forEach(cb => {
          cb.addEventListener("change", (e) => {
            const dayKey = e.target.getAttribute("data-day-key");
            const taskId = e.target.getAttribute("data-task-id");
            if (!state.academy.dailyActions[dayKey]) {
              state.academy.dailyActions[dayKey] = [];
            }
            const list = state.academy.dailyActions[dayKey];
            const idx = list.indexOf(taskId);
            if (e.target.checked && idx === -1) {
              list.push(taskId);
            } else if (!e.target.checked && idx >= 0) {
              list.splice(idx, 1);
            }
            saveState?.();
            updateProgressNote();
          });
        });

        // Navigation buttons
        const prevBtn = document.getElementById("academyPrevDay");
        const nextBtn = document.getElementById("academyNextDay");

        if (prevBtn) {
          prevBtn.onclick = () => {
            if (state.academy.currentDay > 1) {
              state.academy.currentDay -= 1;
              saveState?.();
              renderAcademyLessons();
            }
          };
        }

        if (nextBtn) {
          nextBtn.onclick = () => {
            state.academy.currentDay = Math.min(90, (state.academy.currentDay || 1) + 1);
            if (state.academy.currentDay <= 30) {
              state.academy.currentPhase = 1;
            } else if (state.academy.currentDay <= 60) {
              state.academy.currentPhase = 2;
            } else {
              state.academy.currentPhase = 3;
            }
            saveState?.();
            renderAcademyLessons();
          };
        }

        function updateProgressNote() {
          const el = document.getElementById("academyProgressNote");
          if (!el) return;
          const total = phaseCfg.tasks.length;
          const done = (state.academy.dailyActions[key] || []).length;
          el.textContent = `Tasks completed today: ${done}/${total}`;
        }

        updateProgressNote();
      } catch (err) {
        console.error("Error rendering academy lessons", err);
      }
    }
    
    function renderClientAcquisition() {
      // Update metrics
      updateAcquisitionMetrics();
    }
    
    function renderSalesSystem() {
      // Update sales metrics
      updateSalesMetrics();
    }
    
    function getCurrentPhase() {
      const day = state.academy.currentDay;
      if (day <= 30) return "Foundation (Days 1-30)";
      if (day <= 60) return "Systemize (Days 31-60)";
      return "Scale (Days 61-90)";
    }
    
    function calculateTotalRevenue() {
      return state.projects.reduce((total, project) => total + (project.paid || 0), 0);
    }
    
    function updateProgressBars() {
      // Update progress bars based on academy state
      // This would be more sophisticated in a full implementation
    }
    
    function updateAcquisitionMetrics() {
      // Update acquisition metrics based on state
    }
    
    function updateSalesMetrics() {
      // Update sales metrics based on state
    }

    // ---------- KPI / Dashboard ----------
    function renderDashboard(){
      const active = state.projects.filter(p => p.status!=="delivered").length;
      const apiRevenue = state.apis.reduce((sum, api) => sum + (api.revenue || 0), 0);
      const apiKeys = state.apis.length;
      const usage = state.apis.reduce((sum, api) => sum + (api.usage || 0), 0) / Math.max(state.apis.length, 1);

      document.getElementById("kpi-projects").textContent = active || "-";
      document.getElementById("kpi-revenue").textContent = apiRevenue ? "$" + apiRevenue.toFixed(2) : "-";
      document.getElementById("kpi-keys").textContent = apiKeys || "-";
      document.getElementById("kpi-usage").textContent = usage ? usage.toFixed(0) + "%" : "-";
      document.getElementById("bar-projects").style.width = Math.min(100, active*10) + "%";
      document.getElementById("bar-revenue").style.width = Math.min(100, (apiRevenue/1000)*10) + "%";

      // Business Pipeline lists
      const leads = state.projects.filter(p => p.status === "lead");
      const dev = state.projects.filter(p => p.status === "dev");
      const testing = state.projects.filter(p => p.status === "qa");
      const delivered = state.projects.filter(p => p.status === "delivered");

      const mk = (id, arr) => {
        const el = document.getElementById(id);
        if (el) {
          el.innerHTML = arr.slice(0,3)
            .map(a=>`<li class="flex items-center justify-between"><span>${escapeHtml(a.name)}</span><span class="text-slate-400">${money(a.price||0)}</span></li>`)
            .join("") || "<li class='text-slate-400 text-center'>No items</li>";
        }
      };
      
      mk("pipe-leads", leads);
      mk("pipe-dev", dev);
      mk("pipe-testing", testing);
      mk("pipe-delivered", delivered);
    }

    // ---------- Content Studio Enhancements ----------
    function renderContentStats() {
      document.getElementById("totalGenerated").textContent = state.contentStats.totalGenerated;
      document.getElementById("avgQuality").textContent = state.contentStats.avgQuality > 0 ? state.contentStats.avgQuality.toFixed(1) + "/10" : "-";
      document.getElementById("moneyEarned").textContent = "$" + state.contentStats.totalRevenue;
      document.getElementById("timeSavedTotal").textContent = Math.floor(state.contentStats.totalTimeSaved / 60) + "h";
      
      // Update viral energy slider display
      const viralSlider = document.getElementById("viralEnergy");
      if (viralSlider) {
        viralSlider.addEventListener("input", function() {
          document.getElementById("viralValue").textContent = this.value;
        });
      }
    }

    // ---------- Service Packages ----------
    const ServicePackages = {
      selectPackage(type) {
        const packageInfo = state.servicePackages[type];
        if (!packageInfo) return;
        
        document.getElementById("modalTitle").textContent = `Select ${type.charAt(0).toUpperCase() + type.slice(1)} Package`;
        document.getElementById("modalBody").innerHTML = `
          <div class="text-center p-4">
            <div class="text-4xl font-bold text-brand-300 mb-2">$${packageInfo.price}</div>
            <div class="text-lg mb-4">${packageInfo.contentPieces === -1 ? 'Unlimited' : packageInfo.contentPieces} Content Pieces</div>
            
            <div class="bg-white/5 rounded-xl p-4 mb-4 text-left">
              <h4 class="font-semibold mb-2">What's Included:</h4>
              <ul class="space-y-1 text-sm">
                <li class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check" class="lucide lucide-check text-green-400"><path d="M20 6 9 17l-5-5"></path></svg> Premium quality content</li>
                <li class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check" class="lucide lucide-check text-green-400"><path d="M20 6 9 17l-5-5"></path></svg> Viral optimization</li>
                <li class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check" class="lucide lucide-check text-green-400"><path d="M20 6 9 17l-5-5"></path></svg> Platform-specific formatting</li>
                ${type !== 'starter' ? '<li class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check" class="lucide lucide-check text-green-400"><path d="M20 6 9 17l-5-5"></path></svg> Content strategy</li>' : ''}
                ${type === 'enterprise' ? '<li class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check" class="lucide lucide-check text-green-400"><path d="M20 6 9 17l-5-5"></path></svg> Performance analytics</li>' : ''}
              </ul>
            </div>
            
            <div class="flex gap-2">
              <button class="flex-1 px-4 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20" onclick="closeModal()">Cancel</button>
              <button class="flex-1 px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="ServicePackages.generateProposal('${type}')">Generate Proposal</button>
            </div>
          </div>
        `;
        openModal();
      },
      
      generateProposal(type) {
        const packageInfo = state.servicePackages[type];
        const proposalContent = `
          CONTENT CREATION PROPOSAL
          
          Package: ${type.charAt(0).toUpperCase() + type.slice(1)}
          Investment: $${packageInfo.price}
          
          Deliverables:
          - ${packageInfo.contentPieces === -1 ? 'Unlimited' : packageInfo.contentPieces} premium content pieces
          - Viral optimization for maximum engagement
          - Platform-specific formatting
          - Professional quality guarantee
          ${type !== 'starter' ? '- Content strategy development' : ''}
          ${type === 'enterprise' ? '- Performance analytics and reporting' : ''}
          
          Timeline: 2-4 weeks
          Revision Rounds: 3
          
          Next Steps:
          1. 50% deposit to begin
          2. Content strategy session
          3. Content creation & delivery
          4. Final payment & handover
          
          This proposal is valid for 30 days.
          
          ${state.business.name || 'Your Business Name'}
          ${state.business.email || 'your@email.com'}
        `;
        
        const blob = new Blob([proposalContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Content-Proposal-${type}-${Date.now()}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        // Track revenue
        state.contentStats.totalRevenue += packageInfo.price;
        saveState();
        renderContentStats();
        
        closeModal();
        showNotification(`Proposal for $${packageInfo.price} package generated successfully!`, 'success');
      },
      
      openCustomBuilder() {
        document.getElementById("modalTitle").textContent = "Build Custom Package";
        document.getElementById("modalBody").innerHTML = `
          <form onsubmit="event.preventDefault(); ServicePackages.createCustomPackage();">
            <div class="space-y-3">
              <div>
                <label class="block text-sm text-slate-300 mb-1">Package Name</label>
                <input id="customName" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" placeholder="e.g., Premium Content Bundle">
              </div>
              
              <div>
                <label class="block text-sm text-slate-300 mb-1">Number of Content Pieces</label>
                <input id="customPieces" type="number" min="1" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" value="10">
              </div>
              
              <div>
                <label class="block text-sm text-slate-300 mb-1">Price ($)</label>
                <input id="customPrice" type="number" min="100" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" value="1500">
              </div>
              
              <div>
                <label class="block text-sm text-slate-300 mb-1">Additional Services</label>
                <div class="space-y-2">
                  <label class="flex items-center gap-2"><input type="checkbox" id="includeStrategy"> Content Strategy</label>
                  <label class="flex items-center gap-2"><input type="checkbox" id="includeAnalytics"> Performance Analytics</label>
                  <label class="flex items-center gap-2"><input type="checkbox" id="includeManagement"> Social Media Management</label>
                </div>
              </div>
            </div>
            
            <div class="mt-4 flex items-center justify-end gap-2">
              <button type="button" class="px-4 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20" onclick="closeModal()">Cancel</button>
              <button type="submit" class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600">Create Package</button>
            </div>
          </form>
        `;
        openModal();
      },
      
      createCustomPackage() {
        const name = val("customName");
        const pieces = parseInt(val("customPieces"));
        const price = parseInt(val("customPrice"));
        
        if (!name || !pieces || !price) {
          showNotification("Please fill all required fields", "error");
          return;
        }
        
        const customPackage = {
          name: name,
          contentPieces: pieces,
          price: price,
          includesStrategy: document.getElementById("includeStrategy").checked,
          includesAnalytics: document.getElementById("includeAnalytics").checked,
          includesManagement: document.getElementById("includeManagement").checked
        };
        
        // Generate proposal
        let proposalContent = `CUSTOM CONTENT PACKAGE PROPOSAL\n\n`;
        proposalContent += `Package: ${name}\n`;
        proposalContent += `Investment: $${price}\n\n`;
        proposalContent += `Deliverables:\n`;
        proposalContent += `- ${pieces} premium content pieces\n`;
        proposalContent += `- Viral optimization\n`;
        proposalContent += `- Platform-specific formatting\n`;
        if (customPackage.includesStrategy) proposalContent += `- Content strategy development\n`;
        if (customPackage.includesAnalytics) proposalContent += `- Performance analytics\n`;
        if (customPackage.includesManagement) proposalContent += `- Social media management\n`;
        
        proposalContent += `\nTimeline: 2-4 weeks\nRevision Rounds: 3\n\n`;
        proposalContent += `${state.business.name || 'Your Business Name'}\n`;
        proposalContent += `${state.business.email || 'your@email.com'}`;
        
        const blob = new Blob([proposalContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Custom-Package-${name.replace(/\s+/g, '-')}-${Date.now()}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        // Track revenue
        state.contentStats.totalRevenue += price;
        saveState();
        renderContentStats();
        
        closeModal();
        showNotification(`Custom package proposal for $${price} generated successfully!`, 'success');
      }
    };

    // ---------- Enhanced Content Studio ----------

    const AiRouter = {
      async generateContent({ prompt, mode = "text" }) {
        const errors = [];
        const globalApi = state.apiMarket || {};
        const providers = Array.isArray(globalApi.providers) ? globalApi.providers.filter(p => p && p.enabled !== false) : [];
        const usage = globalApi.usage || {};
        const apiMarketKey = (state.integrations && state.integrations.apiMarketKey) || globalApi.apiKey || "";

        // Split providers into those with explicit free tier limits and those without
        const freeProviders = providers.filter(p => Number(p.freeLimit || 0) > 0 && (!p.capability || p.capability === mode));

        // 1) Try API.market freeâ€‘tier providers first
        if (apiMarketKey && freeProviders.length) {
          for (const provider of freeProviders) {
            const id = provider.id || `${provider.workspace||""}:${provider.apiSlug||""}:${provider.toolName||""}`;
            const limit = Number(provider.freeLimit || 0);
            const used = (usage[id] && usage[id].used) || 0;
            if (limit && used >= limit) continue;

            try {
              const text = await this.callApiMarketMcp({
                apiKey: apiMarketKey,
                workspace: provider.workspace,
                apiSlug: provider.apiSlug,
                toolName: provider.toolName,
                prompt
              });

              const newUsed = used + 1;
              globalApi.usage[id] = { used: newUsed, limit };
              state.apiMarket = globalApi;
              saveState?.();

              if (limit && newUsed >= limit) {
                showNotification(`Free tier exhausted for ${provider.name || provider.apiSlug}. I will automatically switch to the next free provider on the next request.`, "warning");
              } else if (limit && newUsed / limit >= 0.8) {
                showNotification(`You have used ${newUsed}/${limit} free calls for ${provider.name || provider.apiSlug}.`, "info");
              }

              return text;
            } catch (err) {
              console.error("API.market provider failed", provider, err);
              errors.push(`Provider ${provider.name || provider.apiSlug} failed: ${err.message || err}`);
              continue;
            }
          }
        }

        // 2) Fallback to OpenAI if configured
        const openaiKey = (state.integrations && state.integrations.openaiKey) || state.settings.openaiKey;
        if (openaiKey) {
          try {
            return await this.callOpenAI(openaiKey, prompt);
          } catch (err) {
            console.error("OpenAI call failed", err);
            errors.push(`OpenAI failed: ${err.message || err}`);
          }
        }

        const msg = errors.length 
          ? errors.join(" | ")
          : "No available AI provider. Configure API.market providers with free tiers or an OpenAI key in Settings â†’ Integrations.";
        throw new Error(msg);
      },

      async callApiMarketMcp({ apiKey, workspace, apiSlug, toolName, prompt }) {
        if (!workspace || !apiSlug || !toolName) {
          throw new Error("Missing workspace, apiSlug or toolName for API.market MCP call.");
        }

        const url = `https://prod.api.market/api/mcp/${encodeURIComponent(workspace)}/${encodeURIComponent(apiSlug)}`;
        const body = {
          jsonrpc: "2.0",
          id: Date.now(),
          method: "tools/call",
          params: {
            name: toolName,
            arguments: {
              body: {
                input: {
                  prompt
                }
              }
            }
          }
        };

        const res = await fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-api-market-key": apiKey
          },
          body: JSON.stringify(body)
        });

        if (!res.ok) {
          const txt = await res.text().catch(() => "");
          throw new Error(`API.market HTTP ${res.status}: ${txt.slice(0, 200)}`);
        }

        const json = await res.json();
        if (json.error) {
          throw new Error(json.error.message || "API.market JSON-RPC error");
        }

        const result = json.result || json;
        if (typeof result === "string") return result;
        if (result.output && typeof result.output === "string") return result.output;
        if (result.text) return result.text;
        if (Array.isArray(result.choices) && result.choices[0]?.message?.content) {
          return result.choices[0].message.content;
        }
        if (result.data && typeof result.data === "string") return result.data;

        return JSON.stringify(result);
      },

      async callOpenAI(apiKey, prompt) {
        const url = "https://api.openai.com/v1/chat/completions";
        const body = {
          model: "gpt-3.5-turbo",
          messages: [
            {
              role: "system",
              content: "You are an expert social media content creator. Write clear, engaging, conversion-focused content."
            },
            { role: "user", content: prompt }
          ],
          temperature: 0.8,
          max_tokens: 512
        };

        const res = await fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify(body)
        });

        if (!res.ok) {
          const txt = await res.text().catch(() => "");
          throw new Error(`OpenAI HTTP ${res.status}: ${txt.slice(0, 200)}`);
        }

        const json = await res.json();
        return json.choices?.[0]?.message?.content?.trim() || "";
      }
    };

    const ContentStudio = {
      async generateContent() {
        const type = val("contentType");
        const network = val("socialNetwork");
        const topic = val("contentTopic");
        const tone = val("contentTone");
        const viralEnergy = parseInt(val("viralEnergy"));
        const contentLength = val("contentLength");
        const hashtagStrategy = val("hashtagStrategy");
        
        if (!topic) {
          showNotification("Please enter a topic", "error");
          return;
        }
        
        // Ensure at least one AI provider is configured (API.market free tiers or OpenAI)
        const hasApiMarketKey = (state.integrations && state.integrations.apiMarketKey) || (state.apiMarket && state.apiMarket.apiKey);
        const hasApiMarketProviders = state.apiMarket && Array.isArray(state.apiMarket.providers) && state.apiMarket.providers.length > 0;
        const hasOpenAI = state.integrations && state.integrations.openaiKey;
        if ((!hasApiMarketKey || !hasApiMarketProviders) && !hasOpenAI) {
          showNotification("Please configure API.market (with at least one freeâ€‘tier provider) or an OpenAI key in the Integrations section before generating content.", "error");
          openView("integrations");
          return;
        }
        
        const btn = document.getElementById("generateContentBtn");
        const originalText = btn.innerHTML;
        btn.innerHTML = '<div class="loader"></div> Generating Premium Content...';
        btn.disabled = true;
        
        try {
          // Use OpenAI API to generate content
          const prompt = this.buildEnhancedPrompt(type, network, topic, tone, viralEnergy, contentLength, hashtagStrategy);
          const content = await AiRouter.generateContent({ prompt, mode: "text" });
          
          // Calculate quality metrics
          const qualityScore = this.calculateQualityScore(viralEnergy, contentLength);
          const engagementScore = this.calculateEngagementScore(viralEnergy, hashtagStrategy);
          const timeSaved = this.calculateTimeSaved(contentLength, type);
          
          // Display content with quality metrics
          document.getElementById("content-output").innerHTML = `
            <div class="whitespace-pre-wrap mb-4">${content}</div>
            <div class="border-t border-white/10 pt-3">
              <div class="text-xs text-slate-400">Quality optimized for ${network} | Viral Energy: ${viralEnergy}/10</div>
            </div>
          `;
          
          // Show quality metrics
          document.getElementById("qualityMetrics").classList.remove("hidden");
          document.getElementById("qualityScore").textContent = qualityScore + "/10";
          document.getElementById("engagementScore").textContent = engagementScore + "/10";
          document.getElementById("timeSaved").textContent = timeSaved + "min";
          
          // Update stats
          state.contentStats.totalGenerated++;
          state.contentStats.totalTimeSaved += timeSaved;
          state.contentStats.avgQuality = ((state.contentStats.avgQuality * (state.contentStats.totalGenerated - 1)) + qualityScore) / state.contentStats.totalGenerated;
          
          // Save to history
          state.contentHistory.push({
            id: uid(),
            type: type,
            network: network,
            topic: topic,
            content: content,
            qualityScore: qualityScore,
            engagementScore: engagementScore,
            timeSaved: timeSaved,
            createdAt: new Date().toISOString()
          });
          
          saveState();
          renderContentStats();
          
          // Success animation
          document.getElementById("content-output").classList.add("success-animation");
          setTimeout(() => {
            document.getElementById("content-output").classList.remove("success-animation");
          }, 2000);
          
          showNotification("Premium content generated successfully!", "success");
          
        } catch (error) {
          console.error("Error generating content:", error);
          showNotification("Failed to generate content. Please check your API key and try again.", "error");
        } finally {
          btn.innerHTML = originalText;
          btn.disabled = false;
        }
      },
      
      buildEnhancedPrompt(type, network, topic, tone, viralEnergy, contentLength, hashtagStrategy) {
        // Base prompt with enhanced instructions
        let prompt = `Create a ${tone} ${type} for ${network} about "${topic}". `;
        
        // Add viral energy instructions
        if (viralEnergy >= 8) {
          prompt += "Make this extremely viral and shareable. Include hooks, emotional triggers, and call-to-actions that drive engagement. ";
        } else if (viralEnergy >= 6) {
          prompt += "Make this highly engaging with strong hooks and clear value proposition. ";
        }
        
        // Add length instructions
        const lengthInstructions = {
          short: "Keep it concise and punchy (1-2 short paragraphs).",
          medium: "Make it comprehensive but not too long (3-4 paragraphs).",
          long: "Create detailed, in-depth content (5+ paragraphs).",
          detailed: "Make this extremely comprehensive and valuable (7+ paragraphs with examples)."
        };
        prompt += lengthInstructions[contentLength] || lengthInstructions.medium;
        
        // Add hashtag strategy
        const hashtagInstructions = {
          minimal: "Include 1-2 highly relevant hashtags.",
          balanced: "Include 3-5 balanced hashtags (mix of popular and niche).",
          trending: "Focus on trending and high-volume hashtags (5-7).",
          maximal: "Use maximum allowed hashtags for this platform (research platform limits)."
        };
        prompt += " " + (hashtagInstructions[hashtagStrategy] || hashtagInstructions.balanced);
        
        // Platform-specific optimizations
        const platformTips = {
          twitter: "Optimize for Twitter with concise messaging, thread potential, and relevant hashtags. Keep character count in mind.",
          instagram: "Create Instagram-friendly content with visual descriptions and relevant hashtags.",
          linkedin: "Make this professional, value-driven, and suitable for LinkedIn's business audience.",
          tiktok: "Create TikTok-optimized content with hooks, trends, and engagement prompts.",
          facebook: "Make this Facebook-friendly with broader appeal and shareability.",
          youtube: "Create YouTube-optimized content with hooks, timestamps, and engagement asks.",
          reddit: "Make this Reddit-friendly with specific subreddit relevance and community engagement."
        };
        
        prompt += " " + (platformTips[network] || "Optimize for the specified platform.");
        
        prompt += " Ensure high quality, professional tone, and maximum engagement potential.";
        
        return prompt;
      },
      
      calculateQualityScore(viralEnergy, contentLength) {
        let score = 7; // Base score
        
        // Viral energy impact
        score += (viralEnergy - 5) * 0.3;
        
        // Content length impact
        const lengthMultipliers = {
          short: 0.8,
          medium: 1.0,
          long: 1.2,
          detailed: 1.4
        };
        score *= (lengthMultipliers[contentLength] || 1.0);
        
        return Math.min(10, Math.max(1, Math.round(score * 10) / 10));
      },
      
      calculateEngagementScore(viralEnergy, hashtagStrategy) {
        let score = 6; // Base score
        
        // Viral energy impact
        score += (viralEnergy - 5) * 0.4;
        
        // Hashtag strategy impact
        const hashtagMultipliers = {
          minimal: 0.9,
          balanced: 1.0,
          trending: 1.2,
          maximal: 1.1
        };
        score *= (hashtagMultipliers[hashtagStrategy] || 1.0);
        
        return Math.min(10, Math.max(1, Math.round(score * 10) / 10));
      },
      
      calculateTimeSaved(contentLength, type) {
        const baseTimes = {
          social: 15,
          blog: 45,
          email: 20,
          ad: 25,
          video: 60,
          press: 30
        };
        
        const lengthMultipliers = {
          short: 0.7,
          medium: 1.0,
          long: 1.5,
          detailed: 2.0
        };
        
        const baseTime = baseTimes[type] || 30;
        const multiplier = lengthMultipliers[contentLength] || 1.0;
        
        return Math.round(baseTime * multiplier);
      },
      
      async callOpenAI(apiKey, prompt) {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: 'gpt-3.5-turbo',
            messages: [
              {
                role: 'system',
                content: 'You are a professional content creator and viral marketing expert that creates engaging, high-quality content optimized for specific platforms and maximum engagement.'
              },
              {
                role: 'user',
                content: prompt
              }
            ],
            max_tokens: 1500,
            temperature: 0.8
          })
        });
        
        if (!response.ok) {
          throw new Error(`API error: ${response.status}`);
        }
        
        const data = await response.json();
        return data.choices[0].message.content;
      },
      
      copyContent() {
        const content = document.getElementById("content-output").textContent;
        navigator.clipboard.writeText(content).then(() => {
          showNotification("Content copied to clipboard!", "success");
        });
      },
      
      saveContent() {
        const content = document.getElementById("content-output").textContent;
        const topic = val("contentTopic");
        const fileName = `content-${topic.replace(/\s+/g, '-').toLowerCase()}-${Date.now()}.txt`;
        
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showNotification("Content saved as file!", "success");
      },
      
      schedulePost() {
        showNotification("This feature would integrate with social media scheduling APIs. Implementation would require additional API keys.", "info");
      }
    };

    // ---------- Notification System ----------
    function showNotification(message, type = "info") {
      // Remove any existing notifications
      const existingNotifications = document.querySelectorAll('.notification');
      existingNotifications.forEach(notif => notif.remove());
      
      const notification = document.createElement('div');
      notification.className = `notification fixed top-4 right-4 glass rounded-xl p-4 max-w-sm z-50 bounce-in ${
        type === 'success' ? 'border-l-4 border-green-500' :
        type === 'error' ? 'border-l-4 border-red-500' :
        type === 'warning' ? 'border-l-4 border-yellow-500' :
        'border-l-4 border-blue-500'
      }`;
      
      notification.innerHTML = `
        <div class="flex items-start gap-3">
          <div class="mt-0.5">
            ${
              type === 'success' ? '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check-circle" class="lucide lucide-check-circle text-green-400"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg>' :
              type === 'error' ? '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x-circle" class="lucide lucide-x-circle text-red-400"><circle cx="12" cy="12" r="10"></circle><path d="m15 9-6 6"></path><path d="m9 9 6 6"></path></svg>' :
              type === 'warning' ? '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="alert-triangle" class="lucide lucide-alert-triangle text-yellow-400"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><path d="M12 9v4"></path><path d="M12 17h.01"></path></svg>' :
              '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="info" class="lucide lucide-info text-blue-400"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg>'
            }
          </div>
          <div class="flex-1">
            <div class="text-sm font-medium">${message}</div>
          </div>
          <button onclick="this.parentElement.parentElement.remove()" class="text-slate-400 hover:text-white">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
          </button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        if (notification.parentElement) {
          notification.remove();
        }
      }, 5000);
    }

    // ---------- API Inventory ----------
    function renderApiInventory(){
      const container = document.getElementById("apiGrid");
      if (!container) return;
      
      if (state.apis.length === 0) {
        container.innerHTML = `
          <div class="col-span-full glass rounded-2xl p-6 text-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="key" class="lucide lucide-key mx-auto mb-4 text-slate-400"><path d="m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4"></path><path d="m21 2-9.6 9.6"></path><circle cx="7.5" cy="15.5" r="5.5"></circle></svg>
            <h3 class="text-lg font-semibold mb-2">No API Keys Added</h3>
            <p class="text-slate-400 mb-4">Add your first API key to start tracking usage and profits</p>
            <button class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openApiModal()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus" class="lucide lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
              Add Your First API Key
            </button>
          </div>
        `;
        return;
      }
      
      container.innerHTML = state.apis.map(api => {
        const usagePercent = api.freeCalls > 0 ? (api.usedCalls / api.freeCalls) * 100 : 0;
        const remainingCalls = api.freeCalls - api.usedCalls;
        const status = api.usedCalls >= api.freeCalls ? 'inactive' : 'active';
        
        return `
          <div class="card glass rounded-2xl p-4">
            <div class="flex items-center justify-between mb-3">
              <div class="font-semibold">${escapeHtml(api.name)}</div>
              <div class="px-2 py-1 rounded-full text-xs status-${status}">${status === 'active' ? 'Active' : 'Limit Reached'}</div>
            </div>
            
            <div class="mb-3">
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${Math.min(usagePercent, 100)}%"></div>
              </div>
              <div class="flex justify-between text-xs text-slate-400 mt-1">
                <span>${api.usedCalls.toLocaleString()} used</span>
                <span>${remainingCalls > 0 ? remainingCalls.toLocaleString() + ' free' : 'No credits left'}</span>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-2 text-sm mb-3">
              <div>
                <div class="text-slate-400">Provider</div>
                <div>${escapeHtml(api.provider)}</div>
              </div>
              <div>
                <div class="text-slate-400">Cost per call</div>
                <div>$${api.costPerCall?.toFixed(4) || '0.0000'}</div>
              </div>
              <div>
                <div class="text-slate-400">Total value</div>
                <div>$${((api.freeCalls || 0) * (api.costPerCall || 0)).toFixed(2)}</div>
              </div>
              <div>
                <div class="text-slate-400">Usage Limit</div>
                <div>${api.usageLimit ? api.usageLimit.toLocaleString() : 'Unlimited'}</div>
              </div>
            </div>
            
            <div class="flex gap-2">
              <button class="flex-1 px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm" onclick="editApi('${api.id}')">
                Edit
              </button>
              <button class="flex-1 px-3 py-2 rounded-xl bg-red-500/20 text-red-200 border border-red-500/30 hover:bg-red-500/30 text-sm" onclick="deleteApi('${api.id}')">
                Remove
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function openApiModal(id){
      const api = id ? state.apis.find(x=>x.id===id) : { 
        id: uid(), 
        name: "", 
        provider: "", 
        key: "", 
        freeCalls: 0, 
        usedCalls: 0, 
        costPerCall: 0.0001, 
        usageLimit: null 
      };
      
      document.getElementById("modalTitle").textContent = id ? "Edit API Key" : "Add API Key";
      document.getElementById("modalBody").innerHTML = `
        <form onsubmit="event.preventDefault(); saveApi('${api.id}');">
          <div class="space-y-3">
            <div>
              <label class="block text-sm text-slate-300 mb-1">API Name *</label>
              <input id="api_name" value="${escapeAttr(api.name)}" required class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" placeholder="e.g., GPT 4.1-Nano, Image Hosting, etc.">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">API Provider</label>
              <input id="api_provider" value="${escapeAttr(api.provider||"")}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" placeholder="e.g., swift-api, openai, etc.">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">API Key</label>
              <input id="api_key" type="password" value="${escapeAttr(api.key||"")}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" placeholder="Enter your actual API key">
              <div class="text-xs text-slate-400 mt-1">We encrypt and store this securely</div>
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Free Credits</label>
              <input id="api_freeCalls" type="number" value="${api.freeCalls||0}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" placeholder="Number of free calls">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Cost per Call (after free credits)</label>
              <input id="api_costPerCall" type="number" step="0.0001" value="${api.costPerCall||0.0001}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Usage Limit (Optional)</label>
              <input id="api_usageLimit" type="number" value="${api.usageLimit||""}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" placeholder="Set maximum usage">
              <div class="text-xs text-slate-400 mt-1">Set a hard limit to prevent overages</div>
            </div>
          </div>
          
          <div class="mt-4 flex items-center justify-end gap-2">
            <button type="button" class="px-4 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20" onclick="closeModal()">Cancel</button>
            <button type="submit" class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600">${id?"Save Changes":"Add API Key"}</button>
          </div>
        </form>
      `;
      openModal();
    }
    
    function saveApi(id){
      try {
        const data = {
          id: id || uid(),
          name: val("api_name"),
          provider: val("api_provider"),
          key: val("api_key"),
          freeCalls: parseInt(val("api_freeCalls")) || 0,
          usedCalls: 0,
          costPerCall: parseFloat(val("api_costPerCall")) || 0.0001,
          usageLimit: val("api_usageLimit") ? parseInt(val("api_usageLimit")) : null,
          status: "active",
          createdAt: new Date().toISOString()
        };
        
        if (!data.name.trim()) {
          throw new Error("API name is required");
        }
        
        const idx = state.apis.findIndex(a=>a.id===data.id);
        if (idx>=0) {
          state.apis[idx]=data;
        } else {
          state.apis.push(data);
        }
        
        saveState(); 
        closeModal(); 
        renderApiInventory();
        renderDashboard();
        showNotification("API key saved successfully!", "success");
        
      } catch (error) {
        showNotification(`Error: ${error.message}`, "error");
      }
    }
    
    function editApi(id){ openApiModal(id); }
    
    function deleteApi(id){
      const api = state.apis.find(x=>x.id===id);
      if (!api) return;
      if (confirm(`Delete API key "${api.name}"? This action cannot be undone.`)){
        state.apis = state.apis.filter(x=>x.id!==id);
        saveState(); 
        renderApiInventory(); 
        renderDashboard();
        showNotification("API key deleted successfully", "success");
      }
    }

    // ---------- AI Services ----------
    function renderAIServices(){
      const container = document.getElementById("aiServicesGrid");
      if (!container) return;

      const services = Array.isArray(state.aiServices) ? state.aiServices : [];

      if (services.length === 0) {
        container.innerHTML = `
          <div class="card glass rounded-2xl p-4 text-center">
            <div class="text-lg font-semibold mb-1">No AI services configured yet</div>
            <div class="text-sm text-slate-400 mb-4">
              Connect API.market or your favorite model providers here. 
              You can then route the Content Studio through freeâ€‘tier models automatically.
            </div>
            <button class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600 text-sm" onclick="openAIApiModal()">
              + Add AI Service
            </button>
          </div>
        `;
        return;
      }

      container.innerHTML = services.map(service => {
        const capability = service.capability || service.type || "general";
        const freeLimitNum = Number(service.freeLimit || 0);
        const pricingLabel = freeLimitNum > 0
          ? `Free tier: ${freeLimitNum} calls`
          : (service.pricingNote || "Pricing: see API.market listing");

        const status = service.status === "active" ? "active" : "inactive";
        const statusLabel = status === "active" ? "Active" : "Inactive";

        return `
          <div class="card glass rounded-2xl p-4">
            <div class="flex items-center justify-between mb-3">
              <div class="font-semibold">${escapeHtml(service.name || "Untitled service")}</div>
              <div class="px-2 py-1 rounded-full text-xs status-pill status-${status === "active" ? "success" : "warning"}">
                ${statusLabel}
              </div>
            </div>

            <div class="text-sm text-slate-400 mb-1">Provider: ${escapeHtml(service.provider || "")}</div>
            <div class="text-xs text-slate-400 mb-1">Usage: ${escapeHtml(capability)}</div>
            <div class="text-xs text-slate-400 mb-3">${escapeHtml(pricingLabel)}</div>

            <div class="flex gap-2">
              <button class="px-3 py-1 rounded-lg border border-white/10 hover:bg-white/5 text-xs" onclick="editAIService('${service.id}')">
                Edit
              </button>
              <button class="px-3 py-1 rounded-lg border border-red-500/40 text-red-400 hover:bg-red-500/10 text-xs" onclick="deleteAIService('${service.id}')">
                Remove
              </button>
            </div>
          </div>
        `;
      }).join("");
    }


function openAIApiModal(id){
      const existing = id ? state.aiServices.find(x => x.id === id) : null;
      const service = existing || { 
        id: uid(), 
        name: "", 
        provider: "", 
        type: "text-generation",
        capability: "text",
        apiKey: "",
        workspace: "",
        apiSlug: "",
        toolName: "",
        freeLimit: "",
        pricingNote: "",
        endpoint: "",
        status: "active"
      };

      document.getElementById("modalTitle").textContent = id ? "Edit AI Service" : "Add AI Service";
      document.getElementById("modalBody").innerHTML = `
        <form onsubmit="event.preventDefault(); saveAIService('${service.id}');">
          <div class="space-y-4">
            <div>
              <label class="block text-sm text-slate-300 mb-1">Service Name *</label>
              <input id="ai_name" value="${escapeAttr(service.name || "")}" class="w-full rounded-xl px-3 py-2 text-sm bg-slate-900/60 border border-white/10" placeholder="e.g., GPTâ€‘4, Wan 2.2, FaceSwap Image API">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm text-slate-300 mb-1">Provider / Vendor *</label>
                <input id="ai_provider" value="${escapeAttr(service.provider || "")}" class="w-full rounded-xl px-3 py-2 text-sm bg-slate-900/60 border border-white/10" placeholder="e.g., OpenAI, magicapi, ailabtools">
              </div>
              <div>
                <label class="block text-sm text-slate-300 mb-1">Primary Capability *</label>
                <select id="ai_capability" class="w-full rounded-xl px-3 py-2 text-sm bg-slate-900/60 border border-white/10">
                  <option value="">Select usage</option>
                  <option value="text">Text / Chat / Copy</option>
                  <option value="text-to-image">Text â†’ Image</option>
                  <option value="image-to-image">Image â†’ Image</option>
                  <option value="image-to-video">Image â†’ Video</option>
                  <option value="text-to-video">Text â†’ Video</option>
                  <option value="tts">Textâ€‘toâ€‘Speech (TTS)</option>
                  <option value="stt">Speechâ€‘toâ€‘Text (STT)</option>
                  <option value="moderation">Moderation / Detection / NSFW</option>
                  <option value="other">Other / Utility</option>
                </select>
              </div>
            </div>

            <div>
              <label class="block text-sm text-slate-300 mb-1">Provider Type</label>
              <select id="ai_type" class="w-full rounded-xl px-3 py-2 text-sm bg-slate-900/60 border border-white/10">
                <option value="text-generation" ${service.type === "text-generation" ? "selected" : ""}>LLM / Text Generation</option>
                <option value="vision" ${service.type === "vision" ? "selected" : ""}>Vision / Image</option>
                <option value="video" ${service.type === "video" ? "selected" : ""}>Video</option>
                <option value="audio" ${service.type === "audio" ? "selected" : ""}>Audio (TTS/STT)</option>
                <option value="utility" ${service.type === "utility" ? "selected" : ""}>Utility / Tools</option>
              </select>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm text-slate-300 mb-1">API Key (for this provider)</label>
                <input id="ai_apiKey" type="password" value="${escapeAttr(service.apiKey || "")}" class="w-full rounded-xl px-3 py-2 text-sm bg-slate-900/60 border border-white/10" placeholder="Paste providerâ€‘specific key if needed">
                <p class="text-[11px] text-slate-400 mt-1">
                  For API.market MCP flows you can often leave this empty and use your global API.market key in Integrations.
                </p>
              </div>
              <div>
                <label class="block text-sm text-slate-300 mb-1">Status</label>
                <select id="ai_status" class="w-full rounded-xl px-3 py-2 text-sm bg-slate-900/60 border border-white/10">
                  <option value="active" ${service.status !== "inactive" ? "selected" : ""}>Active (router can use this)</option>
                  <option value="inactive" ${service.status === "inactive" ? "selected" : ""}>Inactive</option>
                </select>
              </div>
            </div>

            <div class="border border-white/5 rounded-xl p-3 space-y-2">
              <div class="text-xs font-semibold text-brand-300 mb-1">API.market MCP Settings (for automatic routing)</div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div>
                  <label class="block text-xs text-slate-300 mb-1">Workspace</label>
                  <input id="ai_workspace" value="${escapeAttr(service.workspace || "")}" class="w-full rounded-xl px-2 py-1.5 text-xs bg-slate-900/60 border border-white/10" placeholder="e.g., yourâ€‘workspace">
                </div>
                <div>
                  <label class="block text-xs text-slate-300 mb-1">API Slug / Name</label>
                  <input id="ai_apiSlug" value="${escapeAttr(service.apiSlug || "")}" class="w-full rounded-xl px-2 py-1.5 text-xs bg-slate-900/60 border border-white/10" placeholder="e.g., faceswap-image-v3">
                </div>
                <div>
                  <label class="block text-xs text-slate-300 mb-1">Tool Name</label>
                  <input id="ai_toolName" value="${escapeAttr(service.toolName || "")}" class="w-full rounded-xl px-2 py-1.5 text-xs bg-slate-900/60 border border-white/10" placeholder="e.g., generate, swapFaces, create">
                </div>
              </div>
              <p class="text-[11px] text-slate-400">
                These three fields tell the router exactly which MCP tool to call on API.market for this service.
              </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm text-slate-300 mb-1">Free Tier Limit (calls)</label>
                <input id="ai_freeLimit" type="number" min="0" value="${escapeAttr(service.freeLimit != null ? String(service.freeLimit) : "")}" class="w-full rounded-xl px-3 py-2 text-sm bg-slate-900/60 border border-white/10" placeholder="e.g., 100">
                <p class="text-[11px] text-slate-400 mt-1">
                  Set this to the free calls shown on the API listing (e.g., 100 FREE API calls). 
                  The router will use freeâ€‘tier services first and rotate automatically.
                </p>
              </div>
              <div>
                <label class="block text-sm text-slate-300 mb-1">Pricing / Notes</label>
                <textarea id="ai_pricingNote" rows="3" class="w-full rounded-xl px-3 py-2 text-sm bg-slate-900/60 border border-white/10" placeholder="$0.05 per image, only for important projects">${escapeAttr(service.pricingNote || "")}</textarea>
              </div>
            </div>

            <div>
              <label class="block text-sm text-slate-300 mb-1">Endpoint / Base URL (optional)</label>
              <input id="ai_endpoint" value="${escapeAttr(service.endpoint || "")}" class="w-full rounded-xl px-3 py-2 text-sm bg-slate-900/60 border border-white/10" placeholder="Override base URL if this provider requires it">
            </div>
          </div>

          <div class="mt-6 flex justify-end gap-2">
            <button type="button" class="px-4 py-2 rounded-xl border border-white/10 hover:bg-white/5 text-sm" onclick="closeModal()">
              Cancel
            </button>
            <button type="submit" class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600 text-sm">
              Save Service
            </button>
          </div>
        </form>
      `;

      // Pre-select capability if present
      const capSelect = document.getElementById("ai_capability");
      if (capSelect && service.capability) {
        capSelect.value = service.capability;
      }

      openModal();
    }

    
    function saveAIService(id){
      try {
        const data = {
          id: id || uid(),
          name: val("ai_name"),
          provider: val("ai_provider"),
          type: val("ai_type") || "text-generation",
          capability: val("ai_capability") || "text",
          apiKey: val("ai_apiKey"),
          endpoint: val("ai_endpoint"),
          workspace: val("ai_workspace"),
          apiSlug: val("ai_apiSlug"),
          toolName: val("ai_toolName"),
          freeLimit: Number(val("ai_freeLimit") || 0),
          pricingNote: val("ai_pricingNote"),
          status: val("ai_status") || "active",
          createdAt: new Date().toISOString()
        };

        if (!data.name.trim()) {
          showNotification("Please give this service a clear name.", "error");
          return;
        }
        if (!data.provider.trim()) {
          showNotification("Please specify the provider / vendor (e.g., OpenAI, magicapi).", "error");
          return;
        }
        if (!data.capability) {
          showNotification("Please choose what this API is mainly used for (text, textâ€‘toâ€‘image, TTS, etc.).", "error");
          return;
        }

        // Preserve createdAt when editing
        const existingIdx = state.aiServices.findIndex(s => s.id === data.id);
        if (existingIdx >= 0) {
          data.createdAt = state.aiServices[existingIdx].createdAt || data.createdAt;
          data.updatedAt = new Date().toISOString();
          state.aiServices[existingIdx] = { ...state.aiServices[existingIdx], ...data };
        } else {
          state.aiServices.push(data);
        }

        // Sync lightweight provider map for the router
        if (!state.apiMarket) state.apiMarket = { connected: false, apiKey: "", storeSlug: "", listedProducts: [], providers: [], usage: {} };
        if (!Array.isArray(state.apiMarket.providers)) state.apiMarket.providers = [];
        if (!state.apiMarket.usage) state.apiMarket.usage = state.apiMarket.usage || {};

        state.apiMarket.providers = state.aiServices
          .filter(s => s.status !== "inactive" && s.workspace && s.apiSlug && s.toolName)
          .map(s => ({
            id: s.id,
            name: s.name,
            provider: s.provider,
            capability: s.capability || s.type || "general",
            workspace: s.workspace,
            apiSlug: s.apiSlug,
            toolName: s.toolName,
            freeLimit: Number(s.freeLimit || 0)
          }));

        saveState?.();
        renderAIServices();
        closeModal();
        showNotification("AI service saved successfully. The router will now include it when using freeâ€‘tier providers.", "success");
      } catch (err) {
        console.error("Error saving AI service", err);
        showNotification("There was an error saving this AI service. Check the console for details.", "error");
      }
    }


function editAIService(id){ openAIApiModal(id); }
    
    function deleteAIService(id){
      const service = state.aiServices.find(x=>x.id===id);
      if (!service) return;
      if (confirm(`Delete AI service "${service.name}"? This action cannot be undone.`)){
        state.aiServices = state.aiServices.filter(x=>x.id!==id);
        saveState(); 
        renderAIServices();
        showNotification("AI service deleted successfully", "success");
      }
    }

    // ---------- Domains ----------
    function renderDomains(){
      const container = document.getElementById("domainsGrid");
      if (!container) return;
      
      if (state.domains.length === 0) {
        container.innerHTML = `
          <div class="card glass rounded-2xl p-4 text-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="globe" class="lucide lucide-globe mx-auto mb-4 text-slate-400"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path d="M2 12h20"></path></svg>
            <h3 class="text-lg font-semibold mb-2">No Domains Added</h3>
            <p class="text-slate-400 mb-4">Add your first domain to get started</p>
            <button class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600" onclick="openDomainModal()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus" class="lucide lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
              Add Your First Domain
            </button>
          </div>
        `;
        return;
      }
      
      container.innerHTML = state.domains.map(domain => {
        return `
          <div class="card glass rounded-2xl p-4">
            <div class="flex items-center justify-between mb-3">
              <div class="font-semibold">${escapeHtml(domain.name)}</div>
              <div class="px-2 py-1 rounded-full text-xs status-${domain.status || 'active'}">${domain.status === 'active' ? 'Active' : 'Inactive'}</div>
            </div>
            
            <div class="text-sm text-slate-400 mb-2">Provider: ${escapeHtml(domain.provider)}</div>
            <div class="text-sm text-slate-400 mb-3">Expires: ${domain.expiry ? new Date(domain.expiry).toLocaleDateString() : 'N/A'}</div>
            
            <div class="flex gap-2">
              <button class="flex-1 px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20 text-sm" onclick="editDomain('${domain.id}')">
                Edit
              </button>
              <button class="flex-1 px-3 py-2 rounded-xl bg-red-500/20 text-red-200 border border-red-500/30 hover:bg-red-500/30 text-sm" onclick="deleteDomain('${domain.id}')">
                Remove
              </button>
            </div>
          </div>
        `;
      }).join('');
    }
    
    function openDomainModal(id){
      const domain = id ? state.domains.find(x=>x.id===id) : { 
        id: uid(), 
        name: "", 
        provider: "",
        expiry: "",
        status: "active"
      };
      
      document.getElementById("modalTitle").textContent = id ? "Edit Domain" : "Add Domain";
      document.getElementById("modalBody").innerHTML = `
        <form onsubmit="event.preventDefault(); saveDomain('${domain.id}');">
          <div class="space-y-3">
            <div>
              <label class="block text-sm text-slate-300 mb-1">Domain Name *</label>
              <input id="domain_name" value="${escapeAttr(domain.name)}" required class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" placeholder="e.g., example.com">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Provider</label>
              <input id="domain_provider" value="${escapeAttr(domain.provider||"")}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm" placeholder="e.g., GoDaddy, Namecheap, etc.">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Expiry Date</label>
              <input id="domain_expiry" type="date" value="${domain.expiry ? fmtDateInput(domain.expiry) : ""}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
          </div>
          
          <div class="mt-4 flex items-center justify-end gap-2">
            <button type="button" class="px-4 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20" onclick="closeModal()">Cancel</button>
            <button type="submit" class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600">${id?"Save Changes":"Add Domain"}</button>
          </div>
        </form>
      `;
      openModal();
    }
    
    function saveDomain(id){
      try {
        const data = {
          id: id || uid(),
          name: val("domain_name"),
          provider: val("domain_provider"),
          expiry: val("domain_expiry"),
          status: "active",
          createdAt: new Date().toISOString()
        };
        
        if (!data.name.trim()) {
          throw new Error("Domain name is required");
        }
        
        const idx = state.domains.findIndex(d=>d.id===data.id);
        if (idx>=0) {
          state.domains[idx]=data;
        } else {
          state.domains.push(data);
        }
        
        saveState(); 
        closeModal(); 
        renderDomains();
        showNotification("Domain saved successfully!", "success");
        
      } catch (error) {
        showNotification(`Error: ${error.message}`, "error");
      }
    }
    
    function editDomain(id){ openDomainModal(id); }
    
    function deleteDomain(id){
      const domain = state.domains.find(x=>x.id===id);
      if (!domain) return;
      if (confirm(`Delete domain "${domain.name}"? This action cannot be undone.`)){
        state.domains = state.domains.filter(x=>x.id!==id);
        saveState(); 
        renderDomains();
        showNotification("Domain deleted successfully", "success");
      }
    }

    // ---------- Deployment Services ----------
    async function connectNetlify() {
      const token = state.integrations.netlifyToken;
      if (!token) {
        showNotification("Please add your Netlify token in the Integrations section first", "error");
        openView("integrations");
        return;
      }
      
      try {
        document.getElementById("netlify-status").textContent = "Connecting...";
        
        const response = await fetch('https://api.netlify.com/api/v1/sites', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (!response.ok) {
          throw new Error(`Netlify API error: ${response.status}`);
        }
        
        const sites = await response.json();
        document.getElementById("netlify-status").textContent = "Connected";
        document.getElementById("netlify-sites").textContent = sites.length;
        showNotification("Successfully connected to Netlify!", "success");
        
      } catch (error) {
        console.error("Error connecting to Netlify:", error);
        document.getElementById("netlify-status").textContent = "Connection failed";
        showNotification("Failed to connect to Netlify. Please check your token.", "error");
      }
    }
    
    async function connectVercel() {
      const token = state.integrations.vercelToken;
      if (!token) {
        showNotification("Please add your Vercel token in the Integrations section first", "error");
        return;
      }
      
      // Vercel API implementation would go here
      document.getElementById("vercel-status").textContent = "Connect Vercel token in Integrations";
    }
    
    async function connectGitHub() {
      const token = state.integrations.githubToken;
      if (!token) {
        showNotification("Please add your GitHub token in the Integrations section first", "error");
        openView("integrations");
        return;
      }
      
      try {
        document.getElementById("github-status").textContent = "Connecting...";
        
        const response = await fetch('https://api.github.com/user/repos', {
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });
        
        if (!response.ok) {
          throw new Error(`GitHub API error: ${response.status}`);
        }
        
        const repos = await response.json();
        document.getElementById("github-status").textContent = "Connected";
        document.getElementById("github-repos").textContent = repos.length;
        showNotification("Successfully connected to GitHub!", "success");
        
      } catch (error) {
        console.error("Error connecting to GitHub:", error);
        document.getElementById("github-status").textContent = "Connection failed";
        showNotification("Failed to connect to GitHub. Please check your token.", "error");
      }
    }

    // ---------- Payment Services ----------
    async function connectStripe() {
      const key = state.integrations.stripePK;
      if (!key) {
        showNotification("Please add your Stripe key in the Integrations section first", "error");
        openView("integrations");
        return;
      }
      
      // Stripe API implementation would go here
      document.getElementById("stripe-status").textContent = "Connect Stripe key in Integrations";
    }
    
    async function connectPayPal() {
      const clientId = state.integrations.paypalClientId;
      if (!clientId) {
        showNotification("Please add your PayPal Client ID in the Integrations section first", "error");
        openView("integrations");
        return;
      }
      
      // PayPal API implementation would go here
      document.getElementById("paypal-status").textContent = "Connect PayPal in Integrations";
    }

    // ---------- Revenue Manager ----------
    const RevenueManager = {
      addRevenue() {
        const amount = prompt("Enter revenue amount:");
        if (amount && !isNaN(amount)) {
          // Update UI
          document.getElementById("revenue-current").textContent = `$${amount}`;
          document.getElementById("revenue-progress").style.width = "25%";
          document.getElementById("revenue-status").textContent = "25% Complete";
          showNotification("Revenue added successfully!", "success");
        }
      },
      
      addRevenueSource() {
        const source = prompt("Enter revenue source name:");
        if (source) {
          const sourcesDiv = document.getElementById("revenue-sources");
          sourcesDiv.innerHTML += `
            <div class="flex justify-between items-center p-2 bg-white/5 rounded">
              <span>${source}</span>
              <span>$0</span>
            </div>
          `;
          showNotification("Revenue source added!", "success");
        }
      },
      
      updateGoal() {
        const goal = document.getElementById("goal-amount").value;
        const autoIncrease = document.getElementById("goal-auto-increase").value;
        document.getElementById("revenue-goal").textContent = `$${goal}`;
        showNotification("Revenue goal updated!", "success");
      }
    };

    // ---------- Ads Manager ----------
    const AdsManager = {
      addAffiliate() {
        const program = prompt("Enter affiliate program name:");
        if (program) {
          // Implementation would add affiliate program
          showNotification("Affiliate program added!", "success");
        }
      },
      
      generateAffiliateLink() {
        const url = document.getElementById("affiliate-url").value;
        const program = document.getElementById("affiliate-program").value;
        
        if (!url) {
          showNotification("Please enter a URL", "error");
          return;
        }
        
        let affiliateLink = url;
        if (program === "ticketmaster") {
          affiliateLink += "?aff_id=YOUR_ID";
        } else if (program === "eventbrite") {
          affiliateLink += "?aff=YOUR_CODE";
        }
        
        document.getElementById("generated-link").textContent = affiliateLink;
        document.getElementById("affiliate-result").classList.remove("hidden");
        showNotification("Affiliate link generated!", "success");
      },
      
      copyAffiliateLink() {
        const link = document.getElementById("generated-link").textContent;
        navigator.clipboard.writeText(link).then(() => {
          showNotification("Affiliate link copied to clipboard", "success");
        });
      }
    };

    // ---------- Integrations ----------
    function saveToken(id){
      const v = val(id);
      if (id === "netlifyToken2") {
        state.integrations.netlifyToken = v;
      } else if (id === "googleClientId" || id === "googleRedirect") {
        state.integrations.google = state.integrations.google || {};
        state.integrations.google[id === "googleClientId" ? "clientId" : "redirect"] = v;
      } else {
        state.integrations[id] = v;
      }
      saveState(); 
      showNotification("Integration saved successfully!", "success");
    }
    
    function saveGoogle(){
      state.integrations.google = { 
        clientId: val("googleClientId"), 
        redirect: val("googleRedirect") 
      };
      saveState(); 
      showNotification("Google integration saved!", "success");
    }

    // ---------- Business Settings ----------
    function saveBusiness(){
      state.business = {
        name: val("bizName"), 
        email: val("bizEmail"), 
        currency: val("bizCurrency"), 
        address: val("bizAddress")
      }; 
      saveState(); 
      showNotification("Business profile saved successfully!", "success");
    }

    // ---------- PROJECTS & CLIENTS (Original functionality) ----------
    function renderProjects(){
      const q = document.getElementById("search").value?.toLowerCase() || "";
      const rows = state.projects
        .filter(p => !q || JSON.stringify(p).toLowerCase().includes(q))
        .map(p => {
          const repo = p.repo ? `<a href="${escapeAttr(p.repo)}" target="_blank" class="underline">repo</a>` : "";
          const site = p.site ? `<a href="${escapeAttr(p.site)}" target="_blank" class="underline">site</a>` : "";
          const dash = p.netlify || p.vercel ? `<a href="${escapeAttr(p.netlify || p.vercel)}" target="_blank" class="underline">dash</a>` : "";
          const links = [repo, site, dash].filter(Boolean).join(" Â· ");
          
          return `<tr>
            <td>${escapeHtml(p.name)}</td>
            <td>${escapeHtml(p.client||"")}</td>
            <td>${escapeHtml(p.stack||"")}</td>
            <td>${p.repo?`<a class="underline" target="_blank" href="${escapeAttr(p.repo)}">${shorten(p.repo)}</a>`:""}</td>
            <td>${p.domain?`<a class="underline" target="_blank" href="${escapeAttr("http://"+p.domain)}">${escapeHtml(p.domain)}</a>`:""}</td>
            <td><span class="px-2 py-1 rounded-full text-xs ${badge(p.status)}">${escapeHtml(p.status||"lead")}</span></td>
            <td>${money(p.price||0)}</td>
            <td>${p.due? new Date(p.due).toLocaleDateString() : "â€”"}</td>
            <td>${links}</td>
            <td>
              <button class="text-xs px-2 py-1 rounded bg-white/10 border hover:bg-white/20" onclick="editProject('${p.id}')">Edit</button>
              <button class="text-xs px-2 py-1 rounded bg-red-500/20 text-red-200 border border-red-500/30 hover:bg-red-500/30" onclick="delProject('${p.id}')">Del</button>
            </td>
          </tr>`;
        }).join("");
      
      document.getElementById("projectsTable").innerHTML = rows || `<tr><td colspan="10" class="text-center text-slate-400 py-4">No projects yet. Click "New Project" to get started.</td></tr>`;
      renderDashboard();
    }

    function openProjectModal(id){
      const p = id ? state.projects.find(x=>x.id===id) : { id: uid(), name:"", client:"", stack:"", repo:"", site:"", netlify:"", vercel:"", domain:"", status:"lead", price:0, paid:0, due:"" };
      
      document.getElementById("modalTitle").textContent = id ? "Edit Project" : "New Project";
      document.getElementById("modalBody").innerHTML = `
        <form onsubmit="event.preventDefault(); saveProject('${p.id}');">
          <div class="grid grid-cols-2 gap-3">
            <div class="col-span-2">
              <label class="block text-sm text-slate-300 mb-1">Project Name *</label>
              <input id="p_name" value="${escapeAttr(p.name)}" required class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Client</label>
              <input id="p_client" value="${escapeAttr(p.client||"")}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Tech Stack</label>
              <input id="p_stack" value="${escapeAttr(p.stack||"")}" placeholder="Next.js, Flask, etc." class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Repository URL</label>
              <input id="p_repo" value="${escapeAttr(p.repo||"")}" type="url" placeholder="https://github.com/..." class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Live Site URL</label>
              <input id="p_site" value="${escapeAttr(p.site||"")}" type="url" placeholder="https://..." class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Domain</label>
              <input id="p_domain" value="${escapeAttr(p.domain||"")}" placeholder="example.com" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Netlify Dashboard</label>
              <input id="p_netlify" value="${escapeAttr(p.netlify||"")}" type="url" placeholder="https://app.netlify.com/..." class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Vercel Dashboard</label>
              <input id="p_vercel" value="${escapeAttr(p.vercel||"")}" type="url" placeholder="https://vercel.com/..." class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Status</label>
              <select id="p_status" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
                ${["lead","dev","qa","handover","delivered"].map(s=>`<option value="${s}" ${p.status===s?"selected":""}>${s}</option>`).join("")}
              </select>
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Price ($)</label>
              <input id="p_price" type="number" min="0" step="0.01" value="${p.price||0}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Amount Paid ($)</label>
              <input id="p_paid" type="number" min="0" step="0.01" value="${p.paid||0}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Due Date</label>
              <input id="p_due" type="date" value="${p.due?fmtDateInput(p.due):""}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
          </div>
          
          <div class="mt-4 flex items-center justify-end gap-2">
            <button type="button" class="px-4 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20" onclick="closeModal()">Cancel</button>
            <button type="submit" class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600">${id?"Save Changes":"Create Project"}</button>
          </div>
        </form>
      `;
      openModal();
    }
    
    function saveProject(id){
      try {
        const data = {
          id: id || uid(),
          name: val("p_name"),
          client: val("p_client"),
          stack: val("p_stack"),
          repo: val("p_repo"),
          site: val("p_site"),
          domain: val("p_domain"),
          netlify: val("p_netlify"),
          vercel: val("p_vercel"),
          status: val("p_status"),
          price: +val("p_price")||0,
          paid: +val("p_paid")||0,
          due: val("p_due")
        };
        
        if (!data.name.trim()) {
          throw new Error("Project name is required");
        }
        
        const idx = state.projects.findIndex(p=>p.id===data.id);
        if (idx>=0) {
          state.projects[idx]=data;
        } else {
          state.projects.push(data);
        }
        
        saveState(); 
        closeModal(); 
        renderProjects();
        showNotification("Project saved successfully!", "success");
        
      } catch (error) {
        showNotification(`Error: ${error.message}`, "error");
      }
    }
    
    function editProject(id){ openProjectModal(id); }
    
    function delProject(id){
      const p = state.projects.find(x=>x.id===id);
      if (!p) return;
      if (confirm(`Delete project "${p.name}"? This action cannot be undone.`)){
        state.projects = state.projects.filter(x=>x.id!==id);
        saveState(); 
        renderProjects(); 
        showNotification("Project deleted successfully", "success");
      }
    }

    function renderClients(){
      const q = document.getElementById("search").value?.toLowerCase() || "";
      const rows = state.clients
        .filter(c => !q || JSON.stringify(c).toLowerCase().includes(q))
        .map(c => `<tr>
          <td>${escapeHtml(c.name)}</td>
          <td><a class="underline" href="mailto:${escapeAttr(c.email)}">${escapeHtml(c.email||"")}</a></td>
          <td>${escapeHtml(c.company||"")}</td>
          <td>${escapeHtml(c.phone||"")}</td>
          <td><span class="text-xs bg-slate-500/20 text-slate-200 px-2 py-1 rounded">0 API calls</span></td>
          <td>
            <button class="text-xs px-2 py-1 rounded bg-white/10 border hover:bg-white/20" onclick="editClient('${c.id}')">Edit</button>
            <button class="text-xs px-2 py-1 rounded bg-red-500/20 text-red-200 border border-red-500/30 hover:bg-red-500/30" onclick="delClient('${c.id}')">Del</button>
            </td>
        </tr>`).join("");
      
      document.getElementById("clientsTable").innerHTML = rows || `<tr><td colspan="6" class="text-center text-slate-400 py-4">No clients yet. Click "New Client" to get started.</td></tr>`;
    }
    
    function openClientModal(id){
      const c = id ? state.clients.find(x=>x.id===id) : { id: uid(), name:"", email:"", company:"", phone:"" };
      
      document.getElementById("modalTitle").textContent = id ? "Edit Client" : "New Client";
      document.getElementById("modalBody").innerHTML = `
        <form onsubmit="event.preventDefault(); saveClient('${c.id}');">
          <div class="grid grid-cols-2 gap-3">
            <div class="col-span-2">
              <label class="block text-sm text-slate-300 mb-1">Client Name *</label>
              <input id="c_name" value="${escapeAttr(c.name)}" required class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div class="col-span-2">
              <label class="block text-sm text-slate-300 mb-1">Email</label>
              <input id="c_email" value="${escapeAttr(c.email||"")}" type="email" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Company</label>
              <input id="c_company" value="${escapeAttr(c.company||"")}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
            
            <div>
              <label class="block text-sm text-slate-300 mb-1">Phone</label>
              <input id="c_phone" value="${escapeAttr(c.phone||"")}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
            </div>
          </div>
          
          <div class="mt-4 flex items-center justify-end gap-2">
            <button type="button" class="px-4 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20" onclick="closeModal()">Cancel</button>
            <button type="submit" class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600">${id?"Save Changes":"Create Client"}</button>
          </div>
        </form>
      `;
      openModal();
    }
    
    function saveClient(id){
      try {
        const c = { 
          id: id || uid(), 
          name: val("c_name"), 
          email: val("c_email"), 
          company: val("c_company"), 
          phone: val("c_phone") 
        };
        
        if (!c.name.trim()) {
          throw new Error("Client name is required");
        }
        
        const idx = state.clients.findIndex(x=>x.id===c.id);
        if (idx>=0) {
          state.clients[idx]=c;
        } else {
          state.clients.push(c);
        }
        
        saveState(); 
        closeModal(); 
        renderClients();
        showNotification("Client saved successfully!", "success");
        
      } catch (error) {
        showNotification(`Error: ${error.message}`, "error");
      }
    }
    
    function editClient(id){ openClientModal(id); }
    
    function delClient(id){
      const c = state.clients.find(x=>x.id===id);
      if (!c) return;
      if (confirm(`Delete client "${c.name}"? This action cannot be undone.`)){
        state.clients = state.clients.filter(x=>x.id!==id);
        saveState(); 
        renderClients(); 
        showNotification("Client deleted successfully", "success");
      }
    }

    function renderOrders(){
      const backlog = state.projects.filter(p=>["lead"].includes(p.status));
      const progress = state.projects.filter(p=>["dev","qa"].includes(p.status));
      const done = state.projects.filter(p=>["handover","delivered"].includes(p.status));
      
      const mk = (id, arr) => document.getElementById(id).innerHTML = arr.map(p=>`
        <li class="flex items-center justify-between p-2 hover:bg-white/5 rounded">
          <span>${escapeHtml(p.name)}</span>
          <span class="text-slate-400 text-xs">${p.status}</span>
        </li>
      `).join("") || "<div class='text-slate-400 p-2 text-center'>No items</div>";
      
      mk("ord-backlog", backlog);
      mk("ord-progress", progress);
      mk("ord-done", done);
    }
    
    function openInvoiceModal(){
      if (state.projects.length === 0) {
        showNotification("No projects available to generate an invoice.", "error");
        return;
      }
      
      document.getElementById("modalTitle").textContent = "Generate Invoice";
      document.getElementById("modalBody").innerHTML = `
        <form onsubmit="event.preventDefault(); generateInvoice();">
          <div class="mb-3">
            <label class="block text-sm text-slate-300 mb-1">Select Project</label>
            <select id="invoiceProject" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
              ${state.projects.map(p => `<option value="${p.id}">${escapeHtml(p.name)} - ${escapeHtml(p.client || 'No client')}</option>`).join('')}
            </select>
          </div>
          
          <div class="mb-3">
            <label class="block text-sm text-slate-300 mb-1">Invoice Date</label>
            <input id="invoiceDate" type="date" value="${new Date().toISOString().split('T')[0]}" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
          </div>
          
          <div class="mb-3">
            <label class="block text-sm text-slate-300 mb-1">Due Date</label>
            <input id="invoiceDueDate" type="date" class="w-full bg-white/10 border border-white/10 rounded-xl px-3 py-2 text-sm">
          </div>
          
          <div class="flex items-center justify-end gap-2">
            <button type="button" class="px-4 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/20" onclick="closeModal()">Cancel</button>
            <button type="submit" class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600">Generate Invoice</button>
          </div>
        </form>
      `;
      openModal();
    }
    
    function generateInvoice(){
      try {
        const projectId = val("invoiceProject");
        const invoiceDate = val("invoiceDate");
        const dueDate = val("invoiceDueDate");
        
        const project = state.projects.find(p => p.id === projectId);
        if (!project) throw new Error("Project not found");
        
        const invoiceNumber = `INV-${new Date().getFullYear()}-${Math.random().toString(36).substr(2, 6).toUpperCase()}`;
        
        const invoiceContent = `
          INVOICE ${invoiceNumber}
          Date: ${new Date(invoiceDate).toLocaleDateString()}
          Due Date: ${new Date(dueDate).toLocaleDateString()}
          
          Bill To:
          ${project.client || 'Client Not Specified'}
          
          Project: ${project.name}
          
          Description: Website Development
          Amount: ${money(project.price)}
          
          Payment Instructions:
          Please make payment to ${state.business.name || 'Your Business Name'} via bank transfer or PayPal.
          
          Thank you for your business!
        `;
        
        // Create a downloadable invoice file
        const blob = new Blob([invoiceContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Invoice-${invoiceNumber}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        closeModal();
        showNotification("Invoice generated successfully!", "success");
        
      } catch (error) {
        showNotification(`Error: ${error.message}`, "error");
      }
    }

    // ---------- Modals ----------
    function openModal(){ 
      document.getElementById("modal").classList.remove("hidden"); 
      document.getElementById("modal").classList.add("flex"); 
    }
    
    function closeModal(){ 
      document.getElementById("modal").classList.add("hidden"); 
      document.getElementById("modal").classList.remove("flex"); 
    }

    // ---------- Helpers ----------
    function val(id){ 
      const el = document.getElementById(id);
      return el ? el.value : ""; 
    }
    
    function uid(){ 
      return Math.random().toString(36).slice(2,10) + Date.now().toString(36).slice(-4); 
    }
    
    function money(n){ 
      const cur = state.business.currency || "USD"; 
      return new Intl.NumberFormat(undefined, {style:"currency", currency: cur}).format(n||0); 
    }
    
    function fmtDateInput(d){ 
      const dt = new Date(d); 
      return dt.toISOString().slice(0,10); 
    }
    
    function escapeHtml(s){ 
      return (s||"").toString()
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;"); 
    }
    
    function escapeAttr(s){ 
      return escapeHtml(s).replace(/"/g, "&quot;"); 
    }
    
    function shorten(u){ 
      try { 
        const {host, pathname} = new URL(u); 
        return host + (pathname !== "/" ? pathname.replace(/\/$/, "") : ""); 
      } catch { 
        return u; 
      }
    }
    
    function badge(s){
      const map = { 
        lead: "bg-yellow-500/20 text-yellow-200 border border-yellow-500/30",
        dev: "bg-blue-500/20 text-blue-200 border border-blue-500/30",
        qa: "bg-purple-500/20 text-purple-200 border border-purple-500/30",
        handover: "bg-emerald-500/20 text-emerald-200 border border-emerald-500/30",
        delivered: "bg-slate-500/20 text-slate-200 border border-slate-500/30" 
      };
      return map[s] || "bg-white/10";
    }

    function downloadCSV(){
      const header = ["name","client","stack","repo","site","domain","status","price","paid","due"];
      const rows = state.projects.map(p => header.map(h => `"${(p[h]??"").toString().replace(/"/g,'""')}"`).join(","));
      const csv = header.join(",") + "\n" + rows.join("\n");
      const a = document.createElement("a"); 
      a.href = URL.createObjectURL(new Blob([csv], {type:"text/csv"}));
      a.download = "projects.csv"; 
      a.click();
      showNotification("Projects exported to CSV successfully!", "success");
    }

    // ---------- Event Listeners ----------
    document.getElementById("search").addEventListener("input", () => { 
      renderProjects(); 
      renderClients(); 
    });

    document.getElementById("btnExport").addEventListener("click", ()=>{
      const a = document.createElement("a");
      a.href = URL.createObjectURL(new Blob([JSON.stringify(state,null,2)],{type:"application/json"}));
      a.download = "omni-studio-backup.json"; 
      a.click();
      showNotification("Backup exported successfully!", "success");
    });

    document.getElementById("importFile").addEventListener("change", (e)=>{
      const f = e.target.files[0]; 
      if (!f) return;
      const r = new FileReader();
      r.onload = ()=>{ 
        try { 
          const obj = JSON.parse(r.result); 
          Object.assign(state, obj); 
          saveState(); 
          init(); 
          showNotification("Backup imported successfully!", "success");
        } catch(err) { 
          showNotification("Invalid JSON file.", "error"); 
        } 
      };
      r.readAsText(f);
    });

    // ---------- Quick Add Menu ----------
    document.getElementById("quickAdd").addEventListener("click", function() {
      const options = [
        { label: "New Project", action: () => openProjectModal() },
        { label: "New Client", action: () => openClientModal() },
        { label: "Add API Key", action: () => openApiModal() },
        { label: "Generate Content", action: () => openView("content-studio") }
      ];
      
      // Remove any existing menu
      const existingMenu = document.getElementById("quickAddMenu");
      if (existingMenu) existingMenu.remove();
      
      const rect = this.getBoundingClientRect();
      const menu = document.createElement("div");
      menu.id = "quickAddMenu";
      menu.className = "absolute glass rounded-xl p-2 shadow-lg z-10";
      menu.style.top = rect.bottom + 5 + "px";
      menu.style.right = (window.innerWidth - rect.right) + "px";
      
      options.forEach(opt => {
        const button = document.createElement("button");
        button.textContent = opt.label;
        button.className = "w-full text-left px-3 py-2 rounded-md hover:bg-white/10";
        button.addEventListener("click", opt.action);
        menu.appendChild(button);
      });
      
      document.body.appendChild(menu);
      
      // Close menu when clicking outside
      const closeMenu = function(e) {
        if (!menu.contains(e.target) && e.target !== this) {
          menu.remove();
          document.removeEventListener("click", closeMenu);
        }
      };
      
      setTimeout(() => {
        document.addEventListener("click", closeMenu);
      }, 10);
    });

    // ---------- Init ----------
    function init(){
      document.getElementById("year").textContent = new Date().getFullYear();
      
      // Theme + background
      applyTheme();
      applyBackground(true);
      document.getElementById("bgUrl").value = state.settings.bgUrl || "";
      document.getElementById("kenToggle").checked = !!state.settings.ken;
      document.querySelectorAll('input[name="bgType"]').forEach(r=> r.checked = (r.value === state.settings.bgType));
      
      // Prefill integrations
      ["netlifyToken","githubToken","cloudflareToken","paypalClientId","stripePK","apiMarketKey","openaiKey"].forEach(id => {
        const el = document.getElementById(id); 
        if (el) el.value = state.integrations[id] || "";
      });
      
      const g = state.integrations.google || {};
      if (document.getElementById("googleClientId")) document.getElementById("googleClientId").value = g.clientId || "";
      if (document.getElementById("googleRedirect")) document.getElementById("googleRedirect").value = g.redirect || "";
      
      // Business
      ["bizName","bizEmail","bizCurrency","bizAddress"].forEach(id => { 
        const el = document.getElementById(id); 
        if (el) el.value = state.business[id.replace("biz","").toLowerCase()] || ""; 
      });
      
      renderDashboard(); 
      renderProjects(); 
      renderClients(); 
      renderOrders();
      renderApiInventory();
      renderAIServices();
      renderDomains();
      renderContentStats();
      renderAcademyDashboard();
      
      // Nav click attachment after rendering
      document.querySelectorAll(".nav-btn").forEach(btn => btn.addEventListener("click", ()=>openView(btn.dataset.view)));
      
      // Default view
      openView("academy-dashboard");
      lucide.createIcons();
    }

    window.addEventListener("DOMContentLoaded", init);
  

// === Portfolio view helpers ===

function mapProjectToPublic(project) {
  if (!project) return null;
  return {
    id: project.id,
    name: project.name || "",
    client: project.client || "",
    stack: project.stack || "",
    domain: project.domain || project.site || "",
    repo: project.repo || "",
    status: project.status || ""
  };
}

function getPublicPortfolioProjects() {
  if (!Array.isArray(state.projects)) return [];
  return state.projects
    .filter(p => p && p.name) // require a name to appear in portfolio
    .map(mapProjectToPublic);
}

function renderPortfolio() {
  const grid = document.getElementById("portfolioGrid");
  if (!grid) return;

  const list = getPublicPortfolioProjects();
  if (!list.length) {
    grid.innerHTML = `
      <div class="card glass col-span-full">
        <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
          <div>
            <h3 class="text-sm font-semibold">No portfolio projects yet</h3>
            <p class="text-xs text-slate-300 mt-1">
              Add at least one project in the <strong>Projects</strong> tab (with a name, optional client label, stack
              and live domain) and it will appear here automatically as a case study.
            </p>
          </div>
        </div>
      </div>
    `;
    return;
  }

  grid.innerHTML = list.map(p => {
    const safeDomain = p.domain && !/^https?:\/\//i.test(p.domain)
      ? `https://${p.domain}`
      : (p.domain || "");

    const liveLabel = safeDomain
      ? escapeHtml(safeDomain.replace(/^https?:\/\//i, ""))
      : "Add a live link in Projects";

    const statusLabel = p.status ? escapeHtml(p.status) : "In progress";

    const repoBlock = p.repo
      ? `<a href="${p.repo}" target="_blank" rel="noopener" class="text-[11px] underline decoration-dotted hover:no-underline">View repo (optional)</a>`
      : `<span class="text-[11px] text-slate-400">Repo private / on request</span>`;

    return `
      <article class="card glass flex flex-col justify-between gap-3" data-portfolio-id="${p.id || ""}">
        <header>
          <h3 class="text-sm font-semibold leading-snug">${escapeHtml(p.name || "Untitled project")}</h3>
          ${p.client ? `<p class="mt-1 text-[11px] uppercase tracking-wide text-slate-400">${escapeHtml(p.client)}</p>` : ""}
        </header>
        <dl class="mt-1 grid gap-1 text-xs">
          ${p.stack ? `<div class="flex justify-between gap-2">
            <dt class="text-slate-400">Stack</dt>
            <dd class="text-right">${escapeHtml(p.stack)}</dd>
          </div>` : ""}
          ${safeDomain ? `<div class="flex justify-between gap-2">
            <dt class="text-slate-400">Live</dt>
            <dd class="text-right">
              <a href="${safeDomain}" target="_blank" rel="noopener" class="underline decoration-dotted hover:no-underline">
                ${liveLabel}
              </a>
            </dd>
          </div>` : ""}
          <div class="flex justify-between gap-2">
            <dt class="text-slate-400">Status</dt>
            <dd class="text-right">${statusLabel}</dd>
          </div>
        </dl>
        <footer class="mt-3 flex items-center justify-between gap-2">
          <button class="btn-primary text-[11px] px-3 py-1" onclick="sharePortfolioProject('${p.id || ""}')">
            Share portfolio snippet
          </button>
          <div class="flex flex-col items-end gap-1 text-[11px]">
            ${repoBlock}
            ${safeDomain ? `<span class="text-slate-400">Ready for client demos</span>` : ""}
          </div>
        </footer>
      </article>
    `;
  }).join("");
}

function sharePortfolioProject(projectId) {
  const list = getPublicPortfolioProjects();
  const project = list.find(p => p.id === projectId) || list.find(p => !p.id && projectId === "" && p.name);
  if (!project) {
    showNotification("Could not find that project in the portfolio list.", "warning");
    return;
  }

  const domainRaw = project.domain || "";
  const safeDomain = domainRaw && !/^https?:\/\//i.test(domainRaw)
    ? `https://${domainRaw}`
    : domainRaw;

  const lines = [
    project.name ? `Project: ${project.name}` : "",
    project.client ? `Client: ${project.client}` : "",
    project.stack ? `Tech stack: ${project.stack}` : "",
    safeDomain ? `Live: ${safeDomain}` : "",
    project.repo ? `Repo (optional): ${project.repo}` : ""
  ].filter(Boolean);

  const text = lines.join("\\n");

  if (navigator.share && safeDomain) {
    navigator.share({
      title: project.name || "Portfolio project",
      text,
      url: safeDomain
    }).then(() => {
      showNotification("Native share dialog opened for this project.", "success");
    }).catch(() => {
      // ignore, we will still try clipboard below
    });
  }

  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text)
      .then(() => {
        showNotification("Portfolio snippet copied to clipboard.", "success");
      })
      .catch(() => {
        alert("Copy this portfolio snippet:\\n\\n" + text);
      });
  } else {
    alert("Copy this portfolio snippet:\\n\\n" + text);
  }
}

function downloadPortfolioCSV() {
  const list = getPublicPortfolioProjects();
  if (!list.length) {
    showNotification("No portfolio-ready projects to export yet.", "warning");
    return;
  }

  const rows = [
    ["Name", "Client", "Stack", "Live URL", "Repo URL", "Status"]
  ];

  list.forEach(p => {
    rows.push([
      p.name || "",
      p.client || "",
      p.stack || "",
      p.domain || "",
      p.repo || "",
      p.status || ""
    ]);
  });

  const csv = rows.map(row =>
    row.map(value => {
      const v = String(value || "");
      const escaped = v.replace(/"/g, '""');
      return `"${escaped}"`;
    }).join(",")
  ).join("\\n");

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");
  link.href = url;
  link.download = "portfolio_projects.csv";
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);

  showNotification("Portfolio CSV exported.", "success");
}

</script>

</body>
</html>